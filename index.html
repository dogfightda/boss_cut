<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²Œì„ ë³´ìŠ¤ ë¦¬ì   íƒ€ì´ë¨¸ Ver1.2</title>
    <!-- Firebase SDK ì¶”ê°€ -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
    <script>
        // ìŒì„± ì¬ìƒ í•¨ìˆ˜
        function speak(text) {
            try {
                // ìŒì„± íŒŒì¼ ìƒì„± ë° ì¬ìƒ
                const audio = new Audio();
                audio.src = `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodeURIComponent(text)}&tl=ko&client=tw-ob`;
                
                // ìŒì„± ì¬ìƒ ì´ë²¤íŠ¸ ì²˜ë¦¬
                audio.onloadeddata = () => {
                    console.log('ìŒì„± íŒŒì¼ ë¡œë“œ ì™„ë£Œ:', text);
                    audio.play().catch(error => {
                        console.error('ìŒì„± ì¬ìƒ ì‹¤íŒ¨:', error);
                    });
                };
                
                audio.onplay = () => {
                    console.log('ìŒì„± ì¬ìƒ ì‹œì‘:', text);
                };
                
                audio.onended = () => {
                    console.log('ìŒì„± ì¬ìƒ ì™„ë£Œ:', text);
                };
                
                audio.onerror = (error) => {
                    console.error('ìŒì„± ì¬ìƒ ì˜¤ë¥˜:', error);
                    // ì˜¤ë¥˜ ë°œìƒ ì‹œ fallbackìœ¼ë¡œ ë¸Œë¼ìš°ì € ê¸°ë³¸ TTS ì‚¬ìš©
                    if ('speechSynthesis' in window) {
                        const utterance = new SpeechSynthesisUtterance(text);
                        utterance.lang = 'ko-KR';
                        window.speechSynthesis.speak(utterance);
                    }
                };
            } catch (error) {
                console.error('ìŒì„± ì¬ìƒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
            }
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 8px;
            color: #333;
            margin: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 10px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
            padding: 12px;
        }

        .header {
            text-align: center;
            margin-bottom: 12px;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 6px;
            color: white;
            position: relative;
        }

        

        .login-status {
            position: absolute;
            top: 8px;
            right: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
        }

        .login-form {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            margin-bottom: 15px;
            text-align: center;
        }

        .login-form h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .login-inputs {
            display: flex;
            gap: 8px;
            justify-content: center;
            align-items: end;
            flex-wrap: wrap;
        }

        .login-inputs input {
            padding: 8px;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            font-size: 0.9rem;
            min-width: 150px;
        }

        .admin-only {
            display: none !important;
        }

        .admin-logged-in .admin-only {
            display: block !important;
        }

        .admin-logged-in .delete-btn {
            display: inline-block !important;
        }

        .delete-btn {
            display: none !important;
        }

        .user-info {
            background: rgba(255, 255, 255, 0.2);
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
        }

        .logout-btn, .login-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: background 0.3s;
        }

        .logout-btn:hover, .login-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .header h1 {
            font-size: 1.6rem;
            margin-bottom: 4px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 0.8rem;
            opacity: 0.9;
            margin: 0;
        }

        .control-panel {
            margin-bottom: 12px;
        }

        .add-boss-form {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }

        .add-boss-form h3 {
            margin-bottom: 8px;
            color: #2c3e50;
            font-size: 1rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 180px 1fr;
            gap: 8px;
            margin-bottom: 8px;
        }

        .form-group label {
            display: block;
            margin-bottom: 2px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.8rem;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 6px;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            font-size: 0.85rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        .btn-kill {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .btn-small {
            padding: 4px 8px;
            font-size: 0.75rem;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .stat-card {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .stat-label {
            font-size: 0.7rem;
            opacity: 0.8;
        }

        .boss-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 6px;
            margin-top: 8px;
        }

        .boss-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 8px 12px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            min-height: 45px;
        }

        .boss-card.alive {
            border-color: #27ae60;
            background: linear-gradient(135deg, #ffffff 0%, #f8fff8 100%);
        }

        .boss-card.dead {
            border-color: #e74c3c;
            background: linear-gradient(135deg, #ffffff 0%, #fff8f8 100%);
        }

        .boss-card.respawn-soon {
            border-color: #f39c12;
            background: linear-gradient(135deg, #ffffff 0%, #fffbf0 100%);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(243, 156, 18, 0.3); }
            50% { box-shadow: 0 0 0 3px rgba(243, 156, 18, 0); }
        }

        .boss-left {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            min-width: 0;
        }

        .boss-name {
            font-size: 1rem;
            font-weight: 700;
            color: #2c3e50;
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 100px;
        }

        .boss-status {
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.6rem;
            font-weight: 600;
            text-transform: uppercase;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .status-alive {
            background: #27ae60;
            color: white;
        }

        .status-dead {
            background: #e74c3c;
            color: white;
        }

        .status-soon {
            background: #f39c12;
            color: white;
        }

        .boss-details {
            display: flex;
            gap: 8px;
            font-size: 0.75rem;
            color: #7f8c8d;
            align-items: center;
            flex-wrap: wrap;
        }

        .boss-right {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
        }

        .timer-display {
            font-size: 0.9rem;
            font-weight: 700;
            text-align: center;
            padding: 4px 8px;
            border-radius: 4px;
            background: #2c3e50;
            color: white;
            font-family: 'Courier New', monospace;
            min-width: 70px;
            white-space: nowrap;
        }

        .timer-display.respawn-soon {
            background: #f39c12;
            animation: blink 1s infinite;
        }

        .timer-display.unregistered {
            background: #e67e22;
            color: white;
        }

        @keyframes blink {
            50% { opacity: 0.5; }
        }

        .boss-actions {
            display: flex;
            gap: 4px;
            flex-shrink: 0;
        }

        .empty-state {
            text-align: center;
            padding: 30px;
            color: #7f8c8d;
        }

        .notification {
            position: fixed;
            top: 12px;
            right: 12px;
            background: #27ae60;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: 600;
            font-size: 0.85rem;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        @media (max-width: 768px) {
            .container {
                padding: 8px;
            }
            .form-row {
                grid-template-columns: 1fr;
                gap: 6px;
                flex-wrap: wrap !important;
            }
            .add-boss-form .form-row .form-group {
                min-width: 100% !important;
                flex: 1 1 100%;
            }
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
            .boss-card {
                flex-direction: column;
                gap: 4px;
                text-align: left;
                min-height: auto;
                padding: 6px 8px;
            }
            .boss-left {
                flex-direction: row;
                gap: 6px;
                width: 100%;
                flex-wrap: wrap;
                align-items: center;
            }
            .boss-name {
                font-size: 0.9rem;
                min-width: 80px;
                flex: 0 0 auto;
            }
            .boss-status {
                font-size: 0.55rem;
                padding: 1px 4px;
            }
            .boss-details {
                justify-content: flex-start;
                gap: 6px;
                font-size: 0.7rem;
                flex: 1;
            }
            .boss-right {
                flex-direction: row;
                gap: 6px;
                width: 100%;
                justify-content: space-between;
                align-items: center;
            }
            .timer-display {
                font-size: 0.8rem;
                padding: 3px 6px;
                min-width: 60px;
            }
            .boss-actions {
                gap: 3px;
            }
            .btn-small {
                padding: 3px 6px;
                font-size: 0.65rem;
            }
            .header h1 {
                font-size: 1.4rem;
            }
            /* ê³ ì •ë³´ìŠ¤ ë“±ë¡í¼ ì‹œ/ë¶„ ì…ë ¥ë€ í•œ ì¤„ ë°°ì¹˜ */
            #fixedBossForm .form-row,
            #bossForm .boss-form-row {
                flex-wrap: wrap;
                display: flex;
                gap: 8px;
                align-items: flex-end;
            }
            #fixedBossForm .form-row .form-group-hour-minute {
                display: flex;
                flex-direction: row;
                gap: 6px;
                min-width: 120px;
                flex: 0 0 auto;
                align-items: flex-end;
            }
            #fixedBossForm .form-row .form-group-hour-minute label {
                margin-bottom: 0;
            }
            #bossForm .boss-form-row .form-group {
                min-width: 120px;
                flex: 1 1 120px;
            }
            #bossForm .boss-form-row button {
                min-width: 100px;
                margin-top: 20px;
            }
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(3px);
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 25px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            animation: modalSlideIn 0.3s ease;
            }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
        }

        .modal-header h3 {
            margin: 0;
            color: #2c3e50;
            font-size: 1.2rem;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
                justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .close-btn:hover {
            background: #f8f9fa;
            color: #333;
        }

        .modal-body {
            text-align: center;
        }

        .modal-body p {
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        .modal-inputs {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .modal-inputs input {
            padding: 12px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .modal-inputs input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .modal-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }

        .modal-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        /* ìŠ¤íƒ€ì¼ ê°•ì¡° ì¶”ê°€ */
        .stat-card.selected {
            background: linear-gradient(90deg, #667eea 60%, #764ba2 100%);
            color: #fff;
            border: 2.5px solid #3b4cca;
            box-shadow: 0 0 16px #667eea66, 0 2px 12px #764ba244;
            transform: scale(1.07);
            z-index: 2;
            transition: all 0.18s cubic-bezier(0.4,0,0.2,1);
            position: relative;
        }
        .stat-card.selected .stat-number, .stat-card.selected .stat-label {
            color: #fff;
            text-shadow: 0 2px 8px #3b4cca55;
        }

        .weekday-selector {
            display: flex;
            gap: 8px;
            margin: 8px 0;
                flex-wrap: wrap;
            }

        .weekday-checkbox {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .weekday-checkbox input[type="checkbox"] {
            width: auto;
        }

        .weekday-checkbox label {
            font-size: 0.85rem;
            margin: 0;
            cursor: pointer;
        }

        .fixed-boss-options {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
            border: 1px solid #e9ecef;
        }

        .fixed-time-inputs {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-top: 8px;
        }

        .fixed-time-inputs input {
            width: 60px;
            text-align: center;
        }

        /* ëª¨ë“  ì…ë ¥ í•„ë“œì—ì„œ number íƒ€ì… íŠ¹ì„± ì™„ì „íˆ ì œê±° */
        input {
            -webkit-appearance: none !important;
            -moz-appearance: textfield !important;
            appearance: textfield !important;
        }
        
        /* ìŠ¤í•€ ë²„íŠ¼ ì™„ì „ ì œê±° */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none !important;
            margin: 0 !important;
            display: none !important;
        }
        
        /* Firefox number ì…ë ¥ í™”ì‚´í‘œ ì œê±° */
        input[type="number"] {
            -moz-appearance: textfield !important;
        }

        /* ì‹œê°„ ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ ì§ì ‘ ì§€ì • */
        #editRespawnHours, #editRespawnMinutes,
        #respawnHours, #respawnMinutes,
        #fixedHour, #fixedMinute,
        #editFixedHour, #editFixedMinute {
            -webkit-appearance: none !important;
            -moz-appearance: textfield !important;
            appearance: textfield !important;
            width: 60px;
            text-align: center;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 4px;
        }

        /* TTS í† ê¸€ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #ttsToggle {
            position: absolute;
            top: 8px;
            left: 12px;
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            background: rgba(255,255,255,0.2);
            transition: all 0.2s;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="login-status" id="loginStatus">
                <!-- ë¡œê·¸ì¸ ìƒíƒœ í‘œì‹œ ì˜ì—­ -->
            </div>

            <h1>âš”ï¸ ê²Œì„ ë³´ìŠ¤ ë¦¬ì   íƒ€ì´ë¨¸ Ver1.2</h1>
            <p>ë³´ìŠ¤ ëª¬ìŠ¤í„°ì˜ ë¦¬ì   ì‹œê°„ì„ ì¶”ì í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”</p>
        </div>

        <!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
        <div id="loginModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
            <h3>ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</h3>
                    <button class="close-btn" onclick="closeLoginModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <p>ë³´ìŠ¤ ì¶”ê°€/ì‚­ì œë¥¼ ìœ„í•´ ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</p>
                    <div class="modal-inputs">
                        <input type="email" id="modalLoginEmail" placeholder="ì´ë©”ì¼" required>
                        <input type="password" id="modalLoginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
                    </div>
                    <button type="button" class="modal-btn" onclick="login()">ë¡œê·¸ì¸</button>
                </div>
            </div>
        </div>

        <!-- ë³´ìŠ¤ ìˆ˜ì • ëª¨ë‹¬ -->
        <div id="editBossModal" class="modal">
            <div class="modal-content">
                <h2>ë³´ìŠ¤ ì •ë³´ ìˆ˜ì •</h2>
                <div class="form-group">
                    <label for="editBossName">ë³´ìŠ¤ ì´ë¦„</label>
                    <input type="text" id="editBossName" placeholder="ë³´ìŠ¤ ì´ë¦„">
                </div>
                <div class="form-group">
                    <label for="editBossLocation">ìœ„ì¹˜</label>
                    <input type="text" id="editBossLocation" placeholder="ìœ„ì¹˜">
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="editIsFixedBoss"> ê³ ì • ë³´ìŠ¤
                    </label>
                </div>

                <div id="editFixedBossOptions" class="fixed-boss-options" style="display: none;">
                    <div class="weekday-selector">
                        <div class="weekday-checkbox">
                            <input type="checkbox" id="editDay0"><label for="editDay0">ì¼</label>
                        </div>
                        <div class="weekday-checkbox">
                            <input type="checkbox" id="editDay1"><label for="editDay1">ì›”</label>
                        </div>
                        <div class="weekday-checkbox">
                            <input type="checkbox" id="editDay2"><label for="editDay2">í™”</label>
                        </div>
                        <div class="weekday-checkbox">
                            <input type="checkbox" id="editDay3"><label for="editDay3">ìˆ˜</label>
                        </div>
                        <div class="weekday-checkbox">
                            <input type="checkbox" id="editDay4"><label for="editDay4">ëª©</label>
                        </div>
                        <div class="weekday-checkbox">
                            <input type="checkbox" id="editDay5"><label for="editDay5">ê¸ˆ</label>
                        </div>
                        <div class="weekday-checkbox">
                            <input type="checkbox" id="editDay6"><label for="editDay6">í† </label>
                        </div>
                    </div>
                    <div class="fixed-time-inputs">
                        <input type="text" id="editFixedHour" placeholder="ì‹œ">
                        <span>:</span>
                        <input type="text" id="editFixedMinute" placeholder="ë¶„">
                    </div>
                </div>

                <div id="editNormalBossOptions">
                    <div class="form-group">
                        <label>ë¦¬ì   ì‹œê°„</label>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="text" id="editRespawnHours" placeholder="ì‹œê°„" style="width: 80px;">
                            <span>ì‹œê°„</span>
                            <input type="text" id="editRespawnMinutes" placeholder="ë¶„" style="width: 80px;">
                            <span>ë¶„</span>
                        </div>
                    </div>
                </div>

                <div class="modal-buttons">
                    <button onclick="saveEditBoss()" class="btn">ì €ì¥</button>
                    <button onclick="closeEditModal()" class="btn" style="background: #6c757d;">ì·¨ì†Œ</button>
                </div>
            </div>
        </div>

        <div class="stats">
            <div class="stat-card" id="statTotal" onclick="setBossFilter('all')">
                <div class="stat-number" id="totalBosses">0</div>
                <div class="stat-label">ì´ ë³´ìŠ¤ ìˆ˜</div>
            </div>
            <div class="stat-card" id="statAlive" onclick="setBossFilter('alive')">
                <div class="stat-number" id="aliveBosses">0</div>
                <div class="stat-label">ìƒì¡´ ë³´ìŠ¤</div>
            </div>
            <div class="stat-card" id="statDead" onclick="setBossFilter('dead')">
                <div class="stat-number" id="deadBosses">0</div>
                <div class="stat-label">ì‚¬ë§ ë³´ìŠ¤</div>
            </div>
            <div class="stat-card" id="statSoon" onclick="setBossFilter('soon')">
                <div class="stat-number" id="respawnSoon">0</div>
                <div class="stat-label">ê³§ ë¦¬ì  </div>
            </div>
        </div>

        <div class="control-panel admin-only">
            <div class="add-boss-form">
                <h3 style="margin-bottom: 8px; color: #2c3e50;">ìƒˆ ë³´ìŠ¤ ì¶”ê°€</h3>
                <form id="bossForm">
                    <div class="form-row boss-form-row" style="display: flex; gap: 8px; align-items: flex-end; flex-wrap: nowrap;">
                        <div class="form-group" style="min-width: 180px; flex-grow: 1;">
                        <label for="bossName">ë³´ìŠ¤ ì´ë¦„</label>
                            <input type="text" id="bossName" placeholder="ì˜ˆ: ë“œë˜ê³¤ í‚¹" required style="width: 100%;">
                    </div>
                        <div class="form-group" style="min-width: 120px;">
                            <label for="respawnTime">ë¦¬ì   ì‹œê°„</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="text" id="respawnHours" placeholder="0" value="0" style="text-align: center; flex: 1;">
                                <span style="font-size: 0.9rem; color: #7f8c8d;">:</span>
                                <input type="text" id="respawnMinutes" placeholder="0" value="0" style="text-align: center; flex: 1;">
                            </div>
                        </div>
                        <div class="form-group" style="min-width: 160px;">
                        <label for="bossLocation">ìœ„ì¹˜</label>
                        <input type="text" id="bossLocation" placeholder="ì˜ˆ: í™”ì‚° ë˜ì „ 3ì¸µ">
                    </div>
                        <button type="submit" class="btn" style="min-width: 100px; margin-top: 20px;">ë³´ìŠ¤ ì¶”ê°€</button>
                    </div>
                </form>
            </div>
            <!-- ê³ ì •ë³´ìŠ¤ ë“±ë¡ í¼ -->
            <div class="add-boss-form" style="margin-top: 18px;">
                <h3 style="margin-bottom: 8px; color: #2c3e50;">ê³ ì •ë³´ìŠ¤ ë“±ë¡</h3>
                <form id="fixedBossForm">
                    <div class="form-row" style="display: flex; gap: 8px; align-items: flex-end; flex-wrap: nowrap;">
                        <div class="form-group" style="min-width: 200px; flex-grow: 1;">
                            <label for="fixedBossName">ë³´ìŠ¤ ì´ë¦„</label>
                            <input type="text" id="fixedBossName" placeholder="ì˜ˆ: ì›”ìš”ë³´ìŠ¤" required style="width: 100%;">
                        </div>
                        <div class="form-group" style="min-width: 300px;">
                            <label>ìš”ì¼ ì„ íƒ</label>
                            <div class="weekday-selector" style="margin: 0;">
                                <div class="weekday-checkbox">
                                    <input type="checkbox" id="fixedDay0"><label for="fixedDay0">ì¼</label>
                                </div>
                                <div class="weekday-checkbox">
                                    <input type="checkbox" id="fixedDay1"><label for="fixedDay1">ì›”</label>
                                </div>
                                <div class="weekday-checkbox">
                                    <input type="checkbox" id="fixedDay2"><label for="fixedDay2">í™”</label>
                                </div>
                                <div class="weekday-checkbox">
                                    <input type="checkbox" id="fixedDay3"><label for="fixedDay3">ìˆ˜</label>
                                </div>
                                <div class="weekday-checkbox">
                                    <input type="checkbox" id="fixedDay4"><label for="fixedDay4">ëª©</label>
                                </div>
                                <div class="weekday-checkbox">
                                    <input type="checkbox" id="fixedDay5"><label for="fixedDay5">ê¸ˆ</label>
                                </div>
                                <div class="weekday-checkbox">
                                    <input type="checkbox" id="fixedDay6"><label for="fixedDay6">í† </label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group form-group-hour-minute">
                            <div style="display: flex; flex-direction: row; gap: 6px; align-items: flex-end; width: 100%;">
                                <div style="display: flex; flex-direction: column; flex: 1;">
                                    <label for="fixedHour">ì‹œ</label>
                                    <input type="text" id="fixedHour" value="0" style="text-align: center;">
                                </div>
                                <div style="display: flex; flex-direction: column; flex: 1;">
                                    <label for="fixedMinute">ë¶„</label>
                                    <input type="text" id="fixedMinute" value="0" style="text-align: center;">
                                </div>
                            </div>
                        </div>
                        <div class="form-group" style="min-width: 160px;">
                            <label for="fixedLocation">ìœ„ì¹˜</label>
                            <input type="text" id="fixedLocation" placeholder="ì˜ˆ: ì¤‘ì•™ ê´‘ì¥">
                        </div>
                        <button type="submit" class="btn" style="min-width: 100px; margin-top: 20px;">ê³ ì •ë³´ìŠ¤ ë“±ë¡</button>
                    </div>
                </form>
            </div>
            <!-- ì„¤ì • ì˜ì—­: ì „ì²´ ë¦¬ì   ë²„íŠ¼ë§Œ ë³„ë„ ë°°ì¹˜ -->
            <div class="add-boss-form" style="margin-top: 18px;">
                <h3 style="margin-bottom: 8px; color: #2c3e50;">ì„¤ì •</h3>
                <div style="display: flex; gap: 8px; align-items: flex-end;">
                    <button type="button" class="btn" onclick="reviveAllBosses()" style="min-width: 120px; background: linear-gradient(45deg, #27ae60, #2ecc71);">ğŸ”„ ì „ì²´ ë¦¬ì  </button>
                </div>
            </div>
        </div>

        <!-- ë¹ ë¥¸ ì²˜ì¹˜ ì…ë ¥ -->
        <div id="quickKillSection" style="margin-bottom: 15px; display: none;">
            <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; border: 1px solid #e9ecef;">
                <h4 style="margin: 0 0 8px 0; color: #2c3e50; font-size: 0.9rem;">âš¡ ë¹ ë¥¸ ì²˜ì¹˜</h4>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <input type="text" id="quickKillInput" placeholder="ë³´ìŠ¤ì´ë¦„ ã…‹ (ì˜ˆ: íƒ€ìš°ë¡ìŠ¤ ã…‹)" 
                           style="flex: 1; padding: 8px; border: 1px solid #e9ecef; border-radius: 6px; font-size: 0.9rem;">
                    <button type="button" class="btn btn-small" onclick="processQuickKill()">ì…ë ¥</button>
                </div>
                <small style="color: #7f8c8d; font-size: 0.75rem; display: block; margin-top: 4px;">
                    ğŸ’¡ "ë³´ìŠ¤ì´ë¦„ ã…‹" ë˜ëŠ” "[ì‹œê°„] ë³´ìŠ¤ì´ë¦„ ã…‹" í˜•íƒœë¡œ ì…ë ¥í•˜ì„¸ìš”<br>
                    â° ì‹œê°„ í˜•ì‹: HHMMSS ë˜ëŠ” HHMM (ì˜ˆ: 235959 ë˜ëŠ” 2359)<br>
                    ğŸ“ ë³´ìŠ¤ ì´ë¦„ì€ ì• 2ê¸€ì ì´ìƒ ì…ë ¥ (í•˜ë“œë³´ìŠ¤ëŠ” ë°˜ë“œì‹œ 'í•˜ë“œ'ë¡œ ëë‚˜ì•¼ í•¨)
                </small>
            </div>
        </div>

        <div id="bossContainer">
            <div class="empty-state">
                <h3>ë“±ë¡ëœ ë³´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                <p>ìœ„ì˜ ì–‘ì‹ì„ ì‚¬ìš©í•´ì„œ ì²« ë²ˆì§¸ ë³´ìŠ¤ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
            </div>
        </div>
    </div>

    <script>
        console.log('ìŠ¤í¬ë¦½íŠ¸ ì‹œì‘');
        
        // Firebase SDK ë¡œë“œ í™•ì¸
        if (typeof firebase === 'undefined') {
            console.error('Firebase SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            alert('Firebase ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
        } else {
            console.log('Firebase SDK ë¡œë“œ ì™„ë£Œ');
        }

        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyAY6Ff6uZ-iZ7soeuXBU0mtTKKZZ8gAPck",
            authDomain: "bossraidtracker.firebaseapp.com",
            databaseURL: "https://bossraidtracker-default-rtdb.firebaseio.com",
            projectId: "bossraidtracker",
            storageBucket: "bossraidtracker.appspot.com",
            messagingSenderId: "975753692062",
            appId: "1:975753692062:web:0991fb5bcbc52a9d3d0c8f",
            measurementId: "G-MC8YY38ZP3"
        };

        let db, bossTimersRef;
        let bosses = [];
        let timers = {};
        let isLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';
        let currentEditingBoss = null;
        let audioContext = null;
        let soundEnabled = localStorage.getItem('soundEnabled') !== 'false'; // ê¸°ë³¸ê°’ true
        let bossFilter = 'all';

        const ADMIN_EMAIL = 'dogfightda@gmail.com';
        const ADMIN_PASSWORD = '0716';

        // Firebase ì´ˆê¸°í™”
        try {
            console.log('Firebase ì´ˆê¸°í™” ì‹œì‘');
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
            bossTimersRef = db.ref('bossTimers');
            
            // Firebase ë°ì´í„° ë¡œë“œ ë° ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì„¤ì •
            bossTimersRef.on('value', (snapshot) => {
                bosses = Object.keys(snapshot.val() || {}).map(key => ({
                    id: parseInt(key),
                    ...snapshot.val()[key]
                }));
                console.log('Firebaseì—ì„œ ë³´ìŠ¤ ë°ì´í„° ë¡œë“œë¨:', bosses.length, 'ê°œ');
                renderBosses();
            }, (error) => {
                console.error('Firebase ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            });
            
            console.log('Firebase ì´ˆê¸°í™” ì™„ë£Œ');
        } catch (error) {
            console.error('Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
            alert('Firebase ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
        }

        // ë¦¬ì  /ì²˜ì¹˜ ì•Œë¦¼ìŒ ì¬ìƒ í•¨ìˆ˜ë“¤ì€ ì œê±°í•˜ê³  TTSë§Œ ì‚¬ìš©

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded ì´ë²¤íŠ¸ ë°œìƒ');
            
            try {
            updateLoginStatus();
                console.log('ë¡œê·¸ì¸ ìƒíƒœ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                
                if (bossTimersRef) {
                    setupFirebaseListeners();
                    console.log('Firebase ë°ì´í„° ë¡œë“œ ì‹œì‘');
                } else {
                    console.error('bossTimersRefê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                }
                
            startTimers();
                console.log('íƒ€ì´ë¨¸ ì‹œì‘ ì™„ë£Œ');
                
                // ë¹ ë¥¸ ì²˜ì¹˜ ì…ë ¥ í•„ë“œ ì´ë²¤íŠ¸ ë“±ë¡
                setupQuickKillInput();
                console.log('ë¹ ë¥¸ ì²˜ì¹˜ ì…ë ¥ ì„¤ì • ì™„ë£Œ');
                
                // ì‚¬ìš´ë“œ ë²„íŠ¼ ì´ˆê¸°í™”
                updateSoundButton();
                
                setBossFilter('all'); // ê¸°ë³¸ê°’ ì „ì²´ ë³´ìŠ¤
                
                // í…ŒìŠ¤íŠ¸ ìŒì„± ì¬ìƒ
                setTimeout(() => {
                    speak('ë³´ìŠ¤ íƒ€ì´ë¨¸ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }, 1000);
            } catch (error) {
                console.error('ì´ˆê¸°í™” ì¤‘ ì—ëŸ¬ ë°œìƒ:', error);
                alert('ì´ˆê¸°í™” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        });

        // Firebase ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupFirebaseListeners() {
            if (!bossTimersRef) return;
            
            let previousData = null;
            
            bossTimersRef.on('value', (snapshot) => {
                const data = snapshot.val() || {};
                
                // ë°ì´í„°ê°€ ì‹¤ì œë¡œ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸
                const currentDataString = JSON.stringify(data);
                if (currentDataString === previousData) {
                    return; // ë³€ê²½ì‚¬í•­ì´ ì—†ìœ¼ë©´ ë Œë”ë§ ìŠ¤í‚µ
                }
                previousData = currentDataString;
                
                bosses = Object.keys(data).map(key => ({
                    id: parseInt(key),
                    ...data[key]
                }));
                
                console.log('Firebaseì—ì„œ ë³´ìŠ¤ ë°ì´í„° ë¡œë“œë¨:', bosses.length, 'ê°œ');
                renderBosses();
            });
        }

        // ë¹ ë¥¸ ì²˜ì¹˜ ì…ë ¥ ì„¤ì • í•¨ìˆ˜
        function setupQuickKillInput() {
            const quickKillInput = document.getElementById('quickKillInput');
            console.log('quickKillInput ìš”ì†Œ:', quickKillInput);
            
            if (quickKillInput) {
                console.log('ì—”í„°í‚¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡');
                quickKillInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        
                        // ì…ë ¥ ë²„íŠ¼ ì‹œê°ì  íš¨ê³¼
                        const inputButton = document.querySelector('#quickKillSection button');
                        if (inputButton) {
                            inputButton.style.transform = 'translateY(1px)';
                            inputButton.style.boxShadow = '0 1px 3px rgba(102, 126, 234, 0.2)';
                            
                            setTimeout(() => {
                                inputButton.style.transform = '';
                                inputButton.style.boxShadow = '';
                            }, 150);
                        }
                        
                        processQuickKill();
                    }
                });
                
                // ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ ì‹œ ì‹œê°ì  í”¼ë“œë°±
                quickKillInput.addEventListener('focus', function() {
                    this.style.borderColor = '#667eea';
                    this.style.boxShadow = '0 0 0 2px rgba(102, 126, 234, 0.1)';
                });
                
                quickKillInput.addEventListener('blur', function() {
                    this.style.borderColor = '#e9ecef';
                    this.style.boxShadow = '';
                });
            } else {
                console.error('quickKillInput ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
        }

        // ë¡œê·¸ì¸ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'block';
            document.getElementById('modalLoginEmail').focus();
        }

        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('modalLoginEmail').value = '';
            document.getElementById('modalLoginPassword').value = '';
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const loginModal = document.getElementById('loginModal');
            const editModal = document.getElementById('editBossModal');
            if (event.target === loginModal) {
                closeLoginModal();
            } else if (event.target === editModal) {
                closeEditModal();
            }
        }

        // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeLoginModal();
                closeEditModal();
            }
        });

        // ëª¨ë‹¬ì—ì„œ Enter í‚¤ë¡œ ë¡œê·¸ì¸/ì €ì¥
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const loginModal = document.getElementById('loginModal');
                const editModal = document.getElementById('editBossModal');
                if (loginModal.style.display === 'block') {
                    login();
                } else if (editModal.style.display === 'block') {
                    saveEditBoss();
                }
            }
        });

        // ë¡œê·¸ì¸ í•¨ìˆ˜
        function login() {
            const email = document.getElementById('modalLoginEmail').value;
            const password = document.getElementById('modalLoginPassword').value;

            if (email === ADMIN_EMAIL && password === ADMIN_PASSWORD) {
                isLoggedIn = true;
                localStorage.setItem('adminLoggedIn', 'true');
                updateLoginStatus();
                closeLoginModal();
                showNotification('ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } else {
                showNotification('ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
        function logout() {
            isLoggedIn = false;
            localStorage.removeItem('adminLoggedIn');
            updateLoginStatus();
            showNotification('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ë¡œê·¸ì¸ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateLoginStatus() {
            const loginStatus = document.getElementById('loginStatus');
            const container = document.querySelector('.container');

            if (isLoggedIn) {
                loginStatus.innerHTML = `
                    <div class="user-info">ê´€ë¦¬ì</div>
                    <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
                `;
                container.classList.add('admin-logged-in');
            } else {
                loginStatus.innerHTML = `
                    <div class="user-info">ê²ŒìŠ¤íŠ¸ ëª¨ë“œ</div>
                    <button class="login-btn" onclick="showLoginModal()">ê´€ë¦¬ì</button>
                `;
                container.classList.remove('admin-logged-in');
            }
        }

        // ë³´ìŠ¤ ì¶”ê°€ í¼
        document.getElementById('bossForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const hours = parseInt(document.getElementById('respawnHours').value) || 0;
            const minutes = parseInt(document.getElementById('respawnMinutes').value) || 0;
            const totalMinutes = hours * 60 + minutes;
            
            if (totalMinutes <= 0) {
                showNotification('ë¦¬ì   ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (hours > 48) {
                showNotification('ë¦¬ì   ì‹œê°„ì€ ìµœëŒ€ 48ì‹œê°„ê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }
            
            const bossData = {
                id: Date.now(),
                name: document.getElementById('bossName').value,
                respawnTime: totalMinutes,
                location: document.getElementById('bossLocation').value || 'ë¯¸ì„¤ì •',
                status: 'alive',
                lastKilled: null,
                nextRespawn: null,
                unregistered: false,
                autoProcessed: false,
                createdAt: new Date().toISOString()
            };

            // Firebaseì— ë³´ìŠ¤ ë°ì´í„° ì €ì¥
            bossTimersRef.child(bossData.id.toString()).set(bossData)
                .then(() => {
                    document.getElementById('bossForm').reset();
                    document.getElementById('respawnHours').value = '0';
                    document.getElementById('respawnMinutes').value = '0';
                    showNotification(`${bossData.name} ë³´ìŠ¤ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                })
                .catch((error) => {
                    console.error('ë³´ìŠ¤ ì¶”ê°€ ì‹¤íŒ¨:', error);
                    showNotification('ë³´ìŠ¤ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                });
        });

        // ë¦¬ì   ì‹œê°„ ì…ë ¥ í•„ë“œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        document.getElementById('respawnHours').addEventListener('input', function(e) {
            let value = parseInt(e.target.value) || 0;
            if (isNaN(value) || value < 0) value = 0;
            if (value > 48) value = 48;
            e.target.value = value;
        });

        document.getElementById('respawnMinutes').addEventListener('input', function(e) {
            let value = parseInt(e.target.value) || 0;
            if (isNaN(value) || value < 0) value = 0;
            if (value > 59) value = 59;
            e.target.value = value;
        });

        document.getElementById('editRespawnHours').addEventListener('input', function(e) {
            let value = parseInt(e.target.value) || 0;
            if (isNaN(value) || value < 0) value = 0;
            if (value > 48) value = 48;
            e.target.value = value;
        });

        document.getElementById('editRespawnMinutes').addEventListener('input', function(e) {
            let value = parseInt(e.target.value) || 0;
            if (isNaN(value) || value < 0) value = 0;
            if (value > 59) value = 59;
            e.target.value = value;
        });

        // ë³´ìŠ¤ ë Œë”ë§ (Firebase ë¦¬ìŠ¤ë„ˆ ì „ìš©)
        function renderBosses() {
            renderBossesUI();
            updateStats();
        }
            
        // ë³´ìŠ¤ ëª©ë¡ ë Œë”ë§ (Firebase ë¦¬ìŠ¤ë„ˆ ì „ìš©)
        function renderBossesUI() {
            const container = document.getElementById('bossContainer');
            const quickKillSection = document.getElementById('quickKillSection');
            if (bosses.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>ë“±ë¡ëœ ë³´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤</h3><p>ìœ„ì˜ ì–‘ì‹ì„ ì‚¬ìš©í•´ì„œ ì²« ë²ˆì§¸ ë³´ìŠ¤ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!</p></div>';
                quickKillSection.style.display = 'none';
                return;
            }
            quickKillSection.style.display = 'block';
            let filteredBosses = bosses;
            if (bossFilter === 'alive') {
                const now = new Date();
                filteredBosses = bosses.filter(b => {
                    // ìƒì¡´ ìƒíƒœì¸ ë³´ìŠ¤
                    if (b.status === 'alive') return true;
                    
                    // ì¼ë°˜ ë³´ìŠ¤ì˜ ê³§ ë¦¬ì   ìƒíƒœ í™•ì¸
                    if (b.status === 'dead' && b.nextRespawn) {
                        const time = new Date(b.nextRespawn) - now;
                        if (time > 0 && time <= 600000) return true;
                    }
                    
                    // ê³ ì • ë³´ìŠ¤ì˜ ê³§ ë¦¬ì   ìƒíƒœ í™•ì¸
                    if (b.fixed) {
                        let minNextDiff = 7 * 24 * 60;
                        b.fixedDays.forEach(day => {
                            let diff = (day - now.getDay()) * 24 * 60 
                                + (b.fixedHour - now.getHours()) * 60 
                                + (b.fixedMinute - now.getMinutes());
                            if (diff <= 0) diff += 7 * 24 * 60;
                            minNextDiff = Math.min(minNextDiff, diff);
                        });
                        if (minNextDiff * 60 * 1000 <= 600000) return true;
                    }
                    
                    return false;
                });
            } else if (bossFilter === 'dead') {
                filteredBosses = bosses.filter(b => b.status === 'dead');
            } else if (bossFilter === 'soon') {
                filteredBosses = bosses.filter(b => b.status === 'dead' && b.nextRespawn && (new Date(b.nextRespawn) - new Date() > 0) && (new Date(b.nextRespawn) - new Date() <= 600000));
            }
            const sortedBosses = [...filteredBosses].sort((a, b) => {
                const now = new Date();

                // ë³´ìŠ¤ì˜ ë‹¤ìŒ ë¦¬ì  /ìƒíƒœ ì‹œê°„ì„ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜
                function getNextTime(boss) {
                    if (boss.status === 'alive') {
                        return Infinity;  // ì‚´ì•„ìˆëŠ” ë³´ìŠ¤ëŠ” ìµœìƒë‹¨
                    }

                    const now = new Date();
                    
                    if (boss.fixed) {
                        // ê³ ì •ë³´ìŠ¤ì˜ ë‹¤ìŒ ë¦¬ì   ì‹œê°„ ê³„ì‚°
                        const nowDay = now.getDay();
                        const nowHour = now.getHours();
                        const nowMinute = now.getMinutes();
                        let minNextDiff = 7 * 24 * 60;
                        
                        boss.fixedDays.forEach(day => {
                            let diff = (day - nowDay) * 24 * 60 
                                + (boss.fixedHour - nowHour) * 60 
                                + (boss.fixedMinute - nowMinute);
                            if (diff <= 0) diff += 7 * 24 * 60;
                            minNextDiff = Math.min(minNextDiff, diff);
                        });
                        
                        const nextTime = minNextDiff * 60 * 1000;  // ë°€ë¦¬ì´ˆ ë‹¨ìœ„ë¡œ ë³€í™˜
                        return nextTime;
                    }

                    if (boss.status === 'dead' && boss.nextRespawn) {
                        const time = new Date(boss.nextRespawn) - now;
                        return time > 0 ? time : 0;
                    }

                    return 9999999999;  // ê¸°íƒ€ ìƒíƒœëŠ” ë§¨ ì•„ë˜ë¡œ
                }

                const timeA = getNextTime(a);
                const timeB = getNextTime(b);

                // ë‘˜ ë‹¤ ëŒ€ê¸°ì¤‘ì¸ ê²½ìš° ì´ë¦„ìˆœìœ¼ë¡œ ì •ë ¬
                if (timeA === Infinity && timeB === Infinity) {
                    // ê³ ì •ë³´ìŠ¤ë¥¼ ì¼ë°˜ë³´ìŠ¤ë³´ë‹¤ ìœ„ì— ë°°ì¹˜
                    if (a.fixed && !b.fixed) return -1;
                    if (!a.fixed && b.fixed) return 1;
                    return a.name.localeCompare(b.name, 'ko');
                }

                // ëŒ€ê¸°ì¤‘ì¸ ë³´ìŠ¤ê°€ ìµœìƒë‹¨ì— ì˜¤ë„ë¡
                if (timeA === Infinity) return -1;
                if (timeB === Infinity) return 1;

                // ë‚¨ì€ ì‹œê°„ì´ ì ì€ ìˆœì„œëŒ€ë¡œ ì •ë ¬
                if (timeA !== timeB) return timeA - timeB;

                // ì‹œê°„ì´ ê°™ì€ ê²½ìš° ê³ ì •ë³´ìŠ¤ë¥¼ ìœ„ì— ë°°ì¹˜
                if (a.fixed && !b.fixed) return -1;
                if (!a.fixed && b.fixed) return 1;

                // ê·¸ ì™¸ì˜ ê²½ìš° ì´ë¦„ìˆœ
                return a.name.localeCompare(b.name, 'ko');
            });
            
            container.innerHTML = `
                <div class="boss-grid">
                    ${sortedBosses.map(boss => createBossCard(boss)).join('')}
                </div>
            `;
        }

        // ë³´ìŠ¤ ì¹´ë“œ ìƒì„±
        function createBossCard(boss) {
            const now = new Date();
            let statusClass = 'alive';
            let statusText = 'ìƒì¡´';
            let timerDisplay = 'ëŒ€ê¸° ì¤‘';
            let isUnregistered = false;
            
            // ë¦¬ì   ì‹œê°„ì„ ì‹œê°„:ë¶„ í˜•íƒœë¡œ í‘œì‹œ
            let timeDisplay = '';
            if (boss.fixed) {
                const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
                const fixedDaysText = boss.fixedDays.map(day => dayNames[day]).join(', ');
                timeDisplay = `<span>ğŸ“… ${fixedDaysText}ìš”ì¼ ${boss.fixedHour.toString().padStart(2, '0')}:${boss.fixedMinute.toString().padStart(2, '0')}</span>`;
            } else {
                const respawnHours = Math.floor(boss.respawnTime / 60);
                const respawnMins = boss.respawnTime % 60;
                timeDisplay = `<span>â±ï¸ ${respawnHours > 0 ? `${respawnHours}ì‹œê°„ ${respawnMins}ë¶„` : `${respawnMins}ë¶„`}</span>`;
            }
            
            // ì¹´ë“œ í•˜ë‹¨ì— í•­ìƒ ë§ˆì§€ë§‰ ì»· ì‹œê°„ í‘œê¸° (24ì‹œê°„ì œ, NaN ë°©ì§€)
            let lastKilledDisplay = '';
            if (boss.fixed) {
                // ê³ ì •ë³´ìŠ¤ëŠ” ê°€ì¥ ìµœê·¼ì˜ ë¦¬ì   ì‹œê°(ìš”ì¼/ì‹œ/ë¶„) í‘œê¸°
                const now = new Date();
                const nowDay = now.getDay();
                const nowHour = now.getHours();
                const nowMinute = now.getMinutes();
                
                // ë‹¤ìŒ ë¦¬ì   ìš”ì¼/ì‹œ/ë¶„ (í•­ìƒ ë¯¸ë˜)
                let minNextDiff = 7 * 24 * 60;
                let nextDay = nowDay;
                boss.fixedDays.forEach(day => {
                    let diff = (day - nowDay) * 24 * 60 + (boss.fixedHour - nowHour) * 60 + (boss.fixedMinute - nowMinute);
                    if (diff <= 0) diff += 7 * 24 * 60;
                    if (diff < minNextDiff) {
                        minNextDiff = diff;
                        nextDay = day;
                    }
                });
                
                // ê°€ì¥ ìµœê·¼ ë¦¬ì   ì‹œê° ê³„ì‚°
                let minDiff = 7 * 24 * 60;
                let lastDay = nowDay;
                boss.fixedDays.forEach(day => {
                    let diff = (nowDay - day) * 24 * 60 + (nowHour - boss.fixedHour) * 60 + (nowMinute - boss.fixedMinute);
                    if (diff < 0) diff += 7 * 24 * 60;
                    if (diff < minDiff) {
                        minDiff = diff;
                        lastDay = day;
                    }
                });
                
                const lastRegen = new Date(now);
                lastRegen.setDate(now.getDate() - ((nowDay - lastDay + 7) % 7));
                lastRegen.setHours(boss.fixedHour);
                lastRegen.setMinutes(boss.fixedMinute);
                lastRegen.setSeconds(0);

                const nextRegen = new Date(now);
                nextRegen.setDate(now.getDate() + ((nextDay - nowDay + 7) % 7));
                nextRegen.setHours(boss.fixedHour);
                nextRegen.setMinutes(boss.fixedMinute);
                nextRegen.setSeconds(0);
                
                if (!isNaN(lastRegen.getTime())) {
                    const hour = lastRegen.getHours().toString().padStart(2, '0');
                    const min = lastRegen.getMinutes().toString().padStart(2, '0');
                    const sec = lastRegen.getSeconds().toString().padStart(2, '0');
                    
                    const nextHour = nextRegen.getHours().toString().padStart(2, '0');
                    const nextMin = nextRegen.getMinutes().toString().padStart(2, '0');
                    const nextSec = nextRegen.getSeconds().toString().padStart(2, '0');
                    
                    lastKilledDisplay = `<span>ğŸ—¡ï¸ ë§ˆì§€ë§‰ ì»·: ${hour}:${min}:${sec}</span><span style="margin-left: 10px;">â° ë‹¤ìŒ ë¦¬ì  : ${nextHour}:${nextMin}:${nextSec}</span>`;
                }
            } else if (boss.lastKilled) {
                const killedTime = new Date(boss.lastKilled);
                if (!isNaN(killedTime.getTime())) {
                    const hour = killedTime.getHours().toString().padStart(2, '0');
                    const min = killedTime.getMinutes().toString().padStart(2, '0');
                    const sec = killedTime.getSeconds().toString().padStart(2, '0');
                    
                    // ë¦¬ì   ì˜ˆìƒ ì‹œê°„ ê³„ì‚°
                    const expectedRespawnTime = new Date(killedTime.getTime() + boss.respawnTime * 60000);
                    const respawnHour = expectedRespawnTime.getHours().toString().padStart(2, '0');
                    const respawnMin = expectedRespawnTime.getMinutes().toString().padStart(2, '0');
                    const respawnSec = expectedRespawnTime.getSeconds().toString().padStart(2, '0');
                    
                    lastKilledDisplay = `<span>ğŸ—¡ï¸ ë§ˆì§€ë§‰ ì»·: ${hour}:${min}:${sec}</span><span style="margin-left: 10px;">â° ë‹¤ìŒ ë¦¬ì  : ${respawnHour}:${respawnMin}:${respawnSec}</span>`;
                }
            }

            // ê³ ì •ë³´ìŠ¤: ë‹¤ìŒ ë¦¬ì  ê¹Œì§€ ë‚¨ì€ ì‹œê°„ ê³„ì‚° ë° ìƒíƒœ í‘œì‹œ
            if (boss.fixed) {
                // ê³ ì •ë³´ìŠ¤ ë‚¨ì€ ì‹œê°„ ê³„ì‚° ê°œì„ 
                const nowDay = now.getDay();
                const nowHour = now.getHours();
                const nowMinute = now.getMinutes();
                
                // ë‹¤ìŒ ë¦¬ì   ìš”ì¼/ì‹œ/ë¶„ (í•­ìƒ ë¯¸ë˜)
                let minNextDiff = 7 * 24 * 60;
                let nextDay = nowDay;
                boss.fixedDays.forEach(day => {
                    let diff = (day - nowDay) * 24 * 60 + (boss.fixedHour - nowHour) * 60 + (boss.fixedMinute - nowMinute);
                    if (diff <= 0) diff += 7 * 24 * 60;
                    if (diff < minNextDiff) {
                        minNextDiff = diff;
                        nextDay = day;
                    }
                });
                const nextRegen = new Date(now);
                nextRegen.setDate(now.getDate() + ((nextDay - nowDay + 7) % 7));
                nextRegen.setHours(boss.fixedHour);
                nextRegen.setMinutes(boss.fixedMinute);
                nextRegen.setSeconds(0);

                // ìƒíƒœ íŒë‹¨ ë¡œì§ ê°œì„ 
                if (boss.status === 'dead') {
                    let diff = nextRegen - now;
                    if (diff < 0) diff += 7 * 24 * 60 * 60 * 1000;
                    if (diff <= 600000) {
                        statusClass = 'respawn-soon';
                        statusText = 'ê³§ ë¦¬ì  ';
                    } else if (diff <= 0) {
                    statusClass = 'alive';
                    statusText = 'ìƒì¡´';
                        timerDisplay = 'ëŒ€ê¸° ì¤‘';
                } else {
                        statusClass = 'dead';
                        statusText = 'ì‚¬ë§';
                    }
                    timerDisplay = diff > 0 ? formatTime(diff) : 'ëŒ€ê¸° ì¤‘';
                } else if (boss.status === 'alive') {
                    // alive ìƒíƒœì¼ ë•ŒëŠ” ìƒíƒœë¥¼ ë³€ê²½í•˜ì§€ ì•Šê³  ëŒ€ê¸° ì¤‘ë§Œ í‘œì‹œ
                    statusClass = 'alive';
                    statusText = 'ìƒì¡´';
                    timerDisplay = 'ëŒ€ê¸° ì¤‘';
                }
            } else if (boss.status === 'alive') {
                isUnregistered = boss.unregistered || false;
                // lastKilledì´ ìˆë‹¤ë©´ ë¦¬ì   ì‹œê°„ê¹Œì§€ ê³„ì‚°í•´ì„œ í‘œì‹œ
                if (boss.lastKilled) {
                    const killedTime = new Date(boss.lastKilled);
                    const expectedRespawnTime = new Date(killedTime.getTime() + boss.respawnTime * 60000);
                    const timeDiff = expectedRespawnTime - now;
                    if (timeDiff > 0) {
                        // ë¦¬ì  ê¹Œì§€ ë‚¨ì€ ì‹œê°„ (ë¯¸ë“±ë¡ì´ë©´ ë¯¸ë“±ë¡ ë¶™ì„)
                        statusClass = timeDiff <= 600000 ? 'respawn-soon' : 'dead';
                    statusText = timeDiff <= 600000 ? 'ê³§ ë¦¬ì  ' : 'ì‚¬ë§';
                        timerDisplay = formatTime(timeDiff) + (isUnregistered ? ' ë¯¸ë“±ë¡' : '');
                    } else {
                        // ë¦¬ì   ì™„ë£Œ í›„ ëŒ€ê¸°ì¤‘
                        statusClass = 'alive';
                        statusText = 'ìƒì¡´';
                        timerDisplay = 'ëŒ€ê¸° ì¤‘';
                    }
                } else {
                    // ì»· ê¸°ë¡ì´ ì—†ëŠ” ê²½ìš° - ì§„ì§œ ëŒ€ê¸°ì¤‘
                    statusText = 'ìƒì¡´';
                    timerDisplay = 'ëŒ€ê¸° ì¤‘';
                }
            } else if (boss.status === 'dead' && boss.nextRespawn) {
                const respawnTime = new Date(boss.nextRespawn);
                const timeDiff = respawnTime - now;
                isUnregistered = boss.unregistered || false;
                if (timeDiff > 0) {
                    statusClass = timeDiff <= 600000 ? 'respawn-soon' : 'dead';
                    statusText = timeDiff <= 600000 ? 'ê³§ ë¦¬ì  ' : 'ì‚¬ë§';
                    timerDisplay = formatTime(timeDiff) + (isUnregistered ? ' ë¯¸ë“±ë¡' : '');
                } else {
                    statusClass = 'alive';
                    statusText = 'ìƒì¡´';
                    timerDisplay = 'ëŒ€ê¸° ì¤‘';
                }
            }

            return `
                <div class="boss-card ${statusClass}">
                    <div class="boss-left">
                        <div class="boss-status status-${statusClass === 'respawn-soon' ? 'soon' : statusClass}">
                            ${statusText}
                        </div>
                        <div class="boss-name">${boss.name}
                            ${boss.fixed ? '<span style=\"background:#3b4cca;color:#fff;font-size:0.7em;padding:2px 7px;border-radius:8px;margin-left:6px;vertical-align:middle;\">ê³ ì •</span>' : ''}
                        </div>
                            <div class="boss-details">
                                <span>ğŸ“ ${boss.location}</span>
                            ${timeDisplay}
                            ${lastKilledDisplay}
                            </div>
                        </div>
                    <div class="boss-right">
                        <div class="timer-display ${statusClass === 'respawn-soon' ? 'respawn-soon' : ''} ${isUnregistered ? 'unregistered' : ''}" id="timer-${boss.id}">
                            ${timerDisplay}
                        </div>
                    <div class="boss-actions">
                        ${(boss.fixed && statusClass === 'dead') || boss.status === 'dead' ? 
                            `<button class="btn btn-small" onclick="reviveBoss(${boss.id})">ë¦¬ì  </button>` :
                            `<button class="btn btn-kill btn-small" onclick="killBoss(${boss.id})">ì²˜ì¹˜</button>`
                        }
                        <button class="btn btn-small admin-only" onclick="showEditModal(${boss.id})" style="background: #6c757d;">ìˆ˜ì •</button>
                        <button class="btn btn-small delete-btn" onclick="deleteBoss(${boss.id})">ì‚­ì œ</button>
                    </div>
                    </div>
                </div>
            `;
        }

        // ë³´ìŠ¤ ì²˜ì¹˜
        function killBoss(id) {
            const boss = bosses.find(b => b.id === id);
            if (!boss) return;
            const now = new Date();
            let updatedBoss;
            if (boss.fixed) {
                // ê³ ì •ë³´ìŠ¤ì˜ ë‹¤ìŒ ë¦¬ì   ì‹œê°„ ê³„ì‚°
                const nowDay = now.getDay();
                const nowHour = now.getHours();
                const nowMinute = now.getMinutes();
                let minNextDiff = 7 * 24 * 60;
                let nextDay = nowDay;
                
                boss.fixedDays.forEach(day => {
                    let diff = (day - nowDay) * 24 * 60 + (boss.fixedHour - nowHour) * 60 + (boss.fixedMinute - nowMinute);
                    if (diff <= 0) diff += 7 * 24 * 60;
                    if (diff < minNextDiff) {
                        minNextDiff = diff;
                        nextDay = day;
                    }
                });
                
                const nextRegen = new Date(now);
                nextRegen.setDate(now.getDate() + ((nextDay - nowDay + 7) % 7));
                nextRegen.setHours(boss.fixedHour);
                nextRegen.setMinutes(boss.fixedMinute);
                nextRegen.setSeconds(0);
                
                updatedBoss = {
                    ...boss,
                    status: 'dead',
                    lastKilled: now.toISOString(),
                    nextRespawn: nextRegen.toISOString(),  // ë‹¤ìŒ ë¦¬ì   ì‹œê°„ ì„¤ì •
                    unregistered: false,
                    autoProcessed: false  // ìˆ˜ë™ ì²˜ì¹˜ ì‹œì—ëŠ” falseë¡œ ì„¤ì •
                };
            } else {
                updatedBoss = {
                    ...boss,
                    status: 'dead',
                    lastKilled: now.toISOString(),
                    nextRespawn: new Date(now.getTime() + boss.respawnTime * 60000).toISOString(),
                    unregistered: false, // ìˆ˜ë™ ì²˜ì¹˜ ì‹œ ë¯¸ë“±ë¡ ìƒíƒœ í•´ì œ
                    autoProcessed: true
                };
            }
            bossTimersRef.child(id.toString()).update(updatedBoss)
                .then(() => {
                    speak(`${boss.name} ë³´ìŠ¤ë¥¼ ì²˜ì¹˜í–ˆìŠµë‹ˆë‹¤!`); // TTS ì‚¬ìš©
                    showNotification(`${boss.name}ì„(ë¥¼) ì²˜ì¹˜í–ˆìŠµë‹ˆë‹¤! ${formatTime(boss.respawnTime)} í›„ ë¦¬ì  ë©ë‹ˆë‹¤.`);
                })
                .catch((error) => {
                    console.error('ë³´ìŠ¤ ì²˜ì¹˜ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                    showNotification('ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                });
        }

        // ë³´ìŠ¤ ìˆ˜ë™ ë¦¬ì  
        function reviveBoss(id) {
            const boss = bosses.find(b => b.id === id);
            if (!boss) return;
            
            const updatedBoss = {
                ...boss,
                status: 'alive',
                // ë¯¸ë“±ë¡ ë³´ìŠ¤ëŠ” lastKilled ìœ ì§€, ì •ìƒ ë³´ìŠ¤ëŠ” lastKilled ì´ˆê¸°í™”
                lastKilled: boss.unregistered ? boss.lastKilled : null,
                nextRespawn: null
            };
            
            bossTimersRef.child(id.toString()).update(updatedBoss)
                .then(() => {
                    speak(`${boss.name} ë³´ìŠ¤ê°€ ë¦¬ì  ë˜ì—ˆìŠµë‹ˆë‹¤!`); // TTS ì‚¬ìš©
                    const statusText = boss.unregistered ? '(ë¯¸ë“±ë¡ ìƒíƒœ ìœ ì§€)' : '';
                    showNotification(`${boss.name}ì´(ê°€) ë¦¬ì  ë˜ì—ˆìŠµë‹ˆë‹¤! ${statusText}`);
                })
                .catch((error) => {
                    console.error('ë³´ìŠ¤ ë¦¬ì   ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                    showNotification('ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                });
        }

        // ë³´ìŠ¤ ì‚­ì œ
        function deleteBoss(id) {
            if (!isLoggedIn) {
                showNotification('ê´€ë¦¬ìë§Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (confirm('ì •ë§ë¡œ ì´ ë³´ìŠ¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                bossTimersRef.child(id.toString()).remove()
                    .then(() => {
                showNotification('ë³´ìŠ¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    })
                    .catch((error) => {
                        console.error('ë³´ìŠ¤ ì‚­ì œ ì‹¤íŒ¨:', error);
                        showNotification('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    });
            }
        }

        // ì‹œê°„ í˜•ì‹í™”
        function formatTime(milliseconds) {
            const totalSeconds = Math.floor(milliseconds / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            if (hours > 0) {
                return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            } else {
                return `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        // íƒ€ì´ë¨¸ ì‹œì‘ (UI ì—…ë°ì´íŠ¸ë§Œ, Firebase ì—…ë°ì´íŠ¸ ì—†ìŒ)
        function startTimers() {
            // UI ì—…ë°ì´íŠ¸ë¥¼ 1ì´ˆë§ˆë‹¤ë¡œ ë³€ê²½
            setInterval(() => {
                renderBossesUI();
                updateStats();
            }, 1000);
            // ìë™ ì²˜ë¦¬ëŠ” 10ì´ˆë§ˆë‹¤ ì²´í¬ (Firebase ë¶€í•˜ ëŒ€í­ ê°ì†Œ)
            setInterval(() => {
                checkAutoProcessing();
            }, 10000);
        }

        // ìë™ ì²˜ë¦¬ ì²´í¬ (5ë¶„ë§ˆë‹¤ë§Œ ì‹¤í–‰)
        function checkAutoProcessing() {
            const now = new Date();
            const updates = {};
            let hasUpdates = false;
            
            bosses.forEach(boss => {
                // [ê³ ì •ë³´ìŠ¤ ìë™ ë¦¬ì  ]
                if (boss.fixed) {
                    const nowDay = now.getDay();
                    const nowHour = now.getHours();
                    const nowMinute = now.getMinutes();
                    
                    // ë‹¤ìŒ ë¦¬ì   ì‹œê° ê³„ì‚°
                    let minNextDiff = 7 * 24 * 60;
                    let nextDay = nowDay;
                    boss.fixedDays.forEach(day => {
                        let diff = (day - nowDay) * 24 * 60 + (boss.fixedHour - nowHour) * 60 + (boss.fixedMinute - nowMinute);
                        if (diff <= 0) diff += 7 * 24 * 60;
                        if (diff < minNextDiff) {
                            minNextDiff = diff;
                            nextDay = day;
                        }
                    });
                    
                    const nextRegen = new Date(now);
                    nextRegen.setDate(now.getDate() + ((nextDay - nowDay + 7) % 7));
                    nextRegen.setHours(boss.fixedHour);
                    nextRegen.setMinutes(boss.fixedMinute);
                    nextRegen.setSeconds(0);

                    // í˜„ì¬ê°€ ë¦¬ì   íƒ€ì„ì¸ì§€ í™•ì¸ (ì •í™•íˆ ë¶„ë‹¨ìœ„ê¹Œì§€ë§Œ ì²´í¬)
                    const isRegenTime = boss.fixedDays.includes(nowDay) &&
                                      boss.fixedHour === nowHour &&
                                      boss.fixedMinute === nowMinute;

                    // ìˆ˜ë™ìœ¼ë¡œ ì²˜ì¹˜ëœ ê²½ìš°ëŠ” ìë™ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ
                    if (!boss.autoProcessed) {
                        if (boss.status === 'dead' && isRegenTime) {
                            // dead ìƒíƒœì—ì„œ ë¦¬ì   íƒ€ì„ì´ë©´ aliveë¡œ ë³€ê²½
                            updates[`${boss.id}/status`] = 'alive';
                            updates[`${boss.id}/lastKilled`] = null;
                            updates[`${boss.id}/nextRespawn`] = null;
                            updates[`${boss.id}/autoProcessed`] = false;
                            updates[`${boss.id}/unregistered`] = false;
                            hasUpdates = true;
                        } 
                        else if (boss.status === 'alive' && !boss.lastKilled) {
                            // í˜„ì¬ ì‹œê°„ì´ ë¦¬ì   ì‹œê°„ìœ¼ë¡œë¶€í„° 5ë¶„ ì´ìƒ ì§€ë‚¬ëŠ”ì§€ í™•ì¸
                            const currentMinutes = nowHour * 60 + nowMinute;
                            const regenMinutes = boss.fixedHour * 60 + boss.fixedMinute;
                            let timeSinceRegen = currentMinutes - regenMinutes;
                            
                            // ìì •ì„ ë„˜ê¸´ ê²½ìš° ì²˜ë¦¬
                            if (timeSinceRegen < -18 * 60) { // ìì •ì„ ë„˜ê¸´ ê²½ìš° (6ì‹œê°„ ì´ìƒ ì°¨ì´ë‚˜ë©´)
                                timeSinceRegen += 24 * 60;
                            }
                            
                            // ë¦¬ì   ì‹œê°„ìœ¼ë¡œë¶€í„° 5ë¶„ ì´ìƒ ì§€ë‚¬ê³ , ìˆ˜ë™ ì²˜ì¹˜ë˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ìë™ ì²˜ì¹˜
                            if (timeSinceRegen >= 5) {
                                updates[`${boss.id}/status`] = 'dead';
                                updates[`${boss.id}/lastKilled`] = now.toISOString();
                                updates[`${boss.id}/nextRespawn`] = nextRegen.toISOString();
                                updates[`${boss.id}/autoProcessed`] = true;
                                updates[`${boss.id}/unregistered`] = false;
                                hasUpdates = true;
                            }
                        }
                    }
                }
                // [ê¸°ì¡´ ì¼ë°˜ ë³´ìŠ¤ ìë™ì²˜ë¦¬ ë¡œì§]
                // ì»· ì‹œê°„ì´ ìˆëŠ” ë³´ìŠ¤ë§Œ ìë™ ì²˜ì¹˜ ì²´í¬
                if (boss.status === 'alive' && boss.lastKilled && !boss.autoProcessed) {
                    const lastKilledTime = new Date(boss.lastKilled);
                    const expectedRespawnTime = new Date(lastKilledTime.getTime() + boss.respawnTime * 60000);
                    const fiveMinutesAfterRespawn = new Date(expectedRespawnTime.getTime() + 5 * 60 * 1000);
                    
                    // ì˜ˆìƒ ë¦¬ì   ì‹œê°„ì—ì„œ 5ë¶„ì´ ì§€ë‚¬ëŠ”ì§€ ì²´í¬
                    if (now >= fiveMinutesAfterRespawn) {
                        console.log(`${boss.name}: ì˜ˆìƒ ë¦¬ì  (${expectedRespawnTime.toLocaleString()})ì—ì„œ 5ë¶„ ê²½ê³¼ -> ìë™ ì»· ì²˜ë¦¬`);
                        
                        // ì˜ˆìƒ ë¦¬ì   ì‹œê°„ì— ì¡ì•˜ë‹¤ê³  ê°„ì£¼í•˜ê³  lastKilled ì—…ë°ì´íŠ¸
                        const newKillTime = expectedRespawnTime;
                        const newRespawnTime = new Date(newKillTime.getTime() + boss.respawnTime * 60000);
                        
                        updates[`${boss.id}/status`] = 'dead';
                        updates[`${boss.id}/lastKilled`] = newKillTime.toISOString();
                        updates[`${boss.id}/nextRespawn`] = newRespawnTime.toISOString();
                        updates[`${boss.id}/autoProcessed`] = true;
                        updates[`${boss.id}/unregistered`] = true;
                        hasUpdates = true;
                        
                        console.log(`${boss.name}: ìƒˆë¡œìš´ ì»·ì‹œê°„ ${newKillTime.toLocaleString()} -> ë‹¤ìŒ ë¦¬ì   ${newRespawnTime.toLocaleString()}`);
                    }
                }
                
                // í•œë²ˆë„ ì»· ì‹œê°„ì´ ì—†ëŠ” ë³´ìŠ¤ëŠ” ë¬´í•œ ëŒ€ê¸° (ìë™ ì²˜ì¹˜ ì•ˆë¨)
                // if (!boss.lastKilled) -> ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
                
                // alive ìƒíƒœì´ì§€ë§Œ lastKilledì´ ìˆê³  ë¦¬ì   ì‹œê°„ì´ ì§€ë‚œ ê²½ìš° ì²˜ë¦¬
                if (boss.status === 'alive' && boss.lastKilled && boss.unregistered) {
                    const killedTime = new Date(boss.lastKilled);
                    const expectedRespawnTime = new Date(killedTime.getTime() + boss.respawnTime * 60000);
                    
                    if (expectedRespawnTime <= now) {
                        // ë¦¬ì   ì‹œê°„ì´ ì§€ë‚¬ìœ¼ë¯€ë¡œ ë¯¸ë“±ë¡ ìƒíƒœ í•´ì œ
                        console.log(`${boss.name}: ë¦¬ì   ì‹œê°„ ì™„ë£Œ, ë¯¸ë“±ë¡ ìƒíƒœ í•´ì œ`);
                        // ë¯¸ë“±ë¡ ìƒíƒœëŠ” ìœ ì§€í•˜ë˜ autoProcessedë§Œ ë¦¬ì…‹
                        updates[`${boss.id}/autoProcessed`] = false;
                        hasUpdates = true;
                    }
                }
                
                // ë¦¬ì   ì™„ë£Œ ì²˜ë¦¬ (dead ìƒíƒœì—ì„œ nextRespawnì´ ìˆëŠ” ê²½ìš°)
                if (!boss.fixed && boss.status === 'dead' && boss.nextRespawn) {  // ê³ ì •ë³´ìŠ¤ê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì²˜ë¦¬
                    const respawnTime = new Date(boss.nextRespawn);
                    if (respawnTime <= now) {
                        updates[`${boss.id}/status`] = 'alive';
                        updates[`${boss.id}/nextRespawn`] = null;
                        updates[`${boss.id}/autoProcessed`] = false;
                        hasUpdates = true;
                    }
                }
            });
            
            // ì—…ë°ì´íŠ¸ê°€ ìˆì„ ë•Œë§Œ Firebase í˜¸ì¶œ
            if (hasUpdates && bossTimersRef) {
                // ë¦¬ì  ëœ ë³´ìŠ¤ê°€ ìˆëŠ”ì§€ í™•ì¸
                const hasRespawns = Object.keys(updates).some(key => key.endsWith('/status') && updates[key] === 'alive');
                
                bossTimersRef.update(updates)
                    .then(() => {
                        console.log('ìë™ ì²˜ë¦¬ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                        if (hasRespawns) {
                            // ë¦¬ì  ëœ ë³´ìŠ¤ë“¤ì— ëŒ€í•´ TTS ì‹¤í–‰
                            Object.keys(updates).forEach(key => {
                                if (key.endsWith('/status') && updates[key] === 'alive') {
                                    const bossId = key.split('/')[0];
                                    const boss = bosses.find(b => b.id.toString() === bossId);
                                    if (boss) {
                                        speak(`${boss.name} ë³´ìŠ¤ê°€ ë¦¬ì  ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                                    }
                                }
                            });
                        }
                    })
                    .catch((error) => {
                        console.error('ìë™ ì²˜ë¦¬ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                    });
            }
        }

        // ë³´ìŠ¤ ìˆ˜ì • ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function showEditModal(bossId) {
            const boss = bosses.find(b => b.id === bossId);
            if (!boss) return;
            
            currentEditingBoss = boss;
            
            // ëª¨ë‹¬ì— í˜„ì¬ ë³´ìŠ¤ ì •ë³´ ì±„ìš°ê¸°
            document.getElementById('editBossName').value = boss.name;
            document.getElementById('editBossLocation').value = boss.location;
            
            // ê³ ì •ë³´ìŠ¤ ì—¬ë¶€ì— ë”°ë¥¸ UI ì²˜ë¦¬
            const isFixedBoss = boss.fixed || false;
            document.getElementById('editIsFixedBoss').checked = isFixedBoss;
            
            if (isFixedBoss) {
                document.getElementById('editFixedBossOptions').style.display = 'block';
                document.getElementById('editNormalBossOptions').style.display = 'none';
                
                // ìš”ì¼ ì²´í¬ë°•ìŠ¤ ì„¤ì •
                const days = boss.fixedDays || [];
                for (let i = 0; i < 7; i++) {
                    document.getElementById(`editDay${i}`).checked = days.includes(i);
                }
                
                // ì‹œê°„ ì„¤ì •
                document.getElementById('editFixedHour').value = boss.fixedHour || '';
                document.getElementById('editFixedMinute').value = boss.fixedMinute || '';
            } else {
                document.getElementById('editFixedBossOptions').style.display = 'none';
                document.getElementById('editNormalBossOptions').style.display = 'block';
                
                // ì¼ë°˜ ë¦¬ì   ì‹œê°„ ì„¤ì •
                document.getElementById('editRespawnHours').value = Math.floor(boss.respawnTime / 60);
                document.getElementById('editRespawnMinutes').value = boss.respawnTime % 60;
            }
            
            document.getElementById('editBossModal').style.display = 'block';
            document.getElementById('editBossName').focus();
        }

        // ê³ ì •ë³´ìŠ¤ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ì²˜ë¦¬
        document.getElementById('editIsFixedBoss').addEventListener('change', function(e) {
            const isFixed = e.target.checked;
            document.getElementById('editFixedBossOptions').style.display = isFixed ? 'block' : 'none';
            document.getElementById('editNormalBossOptions').style.display = isFixed ? 'none' : 'block';
        });

        function saveEditBoss() {
            if (!currentEditingBoss) return;
            
            const isFixed = document.getElementById('editIsFixedBoss').checked;
            let updatedBoss = {
                ...currentEditingBoss,
                name: document.getElementById('editBossName').value.trim(),
                location: document.getElementById('editBossLocation').value.trim() || 'ë¯¸ì„¤ì •',
                fixed: isFixed
            };
            
            if (!updatedBoss.name) {
                showNotification('ë³´ìŠ¤ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (isFixed) {
                // ì„ íƒëœ ìš”ì¼ ë°°ì—´ ìƒì„±
                const selectedDays = [];
                for (let i = 0; i < 7; i++) {
                    if (document.getElementById(`editDay${i}`).checked) {
                        selectedDays.push(i);
                    }
                }
                
                if (selectedDays.length === 0) {
                    showNotification('ìµœì†Œ í•˜ë‚˜ì˜ ìš”ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                const fixedHour = parseInt(document.getElementById('editFixedHour').value);
                const fixedMinute = parseInt(document.getElementById('editFixedMinute').value);
                
                if (isNaN(fixedHour) || isNaN(fixedMinute) || 
                    fixedHour < 0 || fixedHour > 48 || 
                    fixedMinute < 0 || fixedMinute > 59) {
                    showNotification('ì˜¬ë°”ë¥¸ ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                updatedBoss = {
                    ...updatedBoss,
                    fixedDays: selectedDays,
                    fixedHour: fixedHour,
                    fixedMinute: fixedMinute,
                    respawnTime: 0  // ê³ ì •ë³´ìŠ¤ëŠ” respawnTime ì‚¬ìš© ì•ˆ í•¨
                };
            } else {
                const hours = parseInt(document.getElementById('editRespawnHours').value) || 0;
                const minutes = parseInt(document.getElementById('editRespawnMinutes').value) || 0;
                const totalMinutes = hours * 60 + minutes;
                
                if (totalMinutes <= 0) {
                    showNotification('ë¦¬ì   ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                if (hours > 48) {
                    showNotification('ë¦¬ì   ì‹œê°„ì€ ìµœëŒ€ 48ì‹œê°„ê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    return;
                }
                
                updatedBoss = {
                    ...updatedBoss,
                    respawnTime: totalMinutes,
                    fixedDays: null,
                    fixedHour: null,
                    fixedMinute: null
                };
            }
            
            // Firebaseì— ì—…ë°ì´íŠ¸
            bossTimersRef.child(currentEditingBoss.id.toString()).update(updatedBoss)
                .then(() => {
                    closeEditModal();
                    showNotification(`${updatedBoss.name} ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                })
                .catch((error) => {
                    console.error('ë³´ìŠ¤ ìˆ˜ì • ì‹¤íŒ¨:', error);
                    showNotification('ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                });
        }

        function closeEditModal() {
            document.getElementById('editBossModal').style.display = 'none';
            document.getElementById('editFixedBossOptions').style.display = 'none';
            document.getElementById('editNormalBossOptions').style.display = 'block';
            document.getElementById('editIsFixedBoss').checked = false;
            currentEditingBoss = null;
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('editBossName').value = '';
            document.getElementById('editBossLocation').value = '';
            document.getElementById('editRespawnHours').value = '';
            document.getElementById('editRespawnMinutes').value = '';
            document.getElementById('editFixedHour').value = '';
            document.getElementById('editFixedMinute').value = '';
            
            // ìš”ì¼ ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
            for (let i = 0; i < 7; i++) {
                document.getElementById(`editDay${i}`).checked = false;
            }
        }

        // ì „ì²´ ë³´ìŠ¤ ë¦¬ì  
        function reviveAllBosses() {
            if (!isLoggedIn) {
                showNotification('ê´€ë¦¬ìë§Œ ì „ì²´ ë¦¬ì  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ê³ ì •ë³´ìŠ¤ë¥¼ ì œì™¸í•œ ì‚¬ë§ ìƒíƒœì˜ ë³´ìŠ¤ë§Œ í•„í„°ë§
            const deadBosses = bosses.filter(boss => boss.status === 'dead' && !boss.fixed);
            
            if (deadBosses.length === 0) {
                showNotification('ë¦¬ì  í•  ë³´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (confirm(`${deadBosses.length}ë§ˆë¦¬ì˜ ë³´ìŠ¤ë¥¼ ëª¨ë‘ ë¦¬ì  í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì„œë²„ ì ê²€ í›„ ì‚¬ìš© - ëª¨ë“  ì»· ì‹œê°„ì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤!`)) {
                // Firebase ë°°ì¹˜ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ ê°ì²´ ì¤€ë¹„ (ëª¨ë“  ë³´ìŠ¤ ì»· ì‹œê°„ ì´ˆê¸°í™”)
                const updates = {};
                
                deadBosses.forEach(boss => {
                    updates[`${boss.id}/status`] = 'alive';
                    // ì „ì²´ ë¦¬ì   ì‹œ ëª¨ë“  ë³´ìŠ¤ì˜ ì»· ì‹œê°„ ì´ˆê¸°í™” (ì„œë²„ ì ê²€ í›„ ìƒˆë¡œ ì‹œì‘)
                    updates[`${boss.id}/lastKilled`] = null;
                    updates[`${boss.id}/nextRespawn`] = null;
                    updates[`${boss.id}/unregistered`] = false;
                    updates[`${boss.id}/autoProcessed`] = false;
                });
                
                // ë°°ì¹˜ ì—…ë°ì´íŠ¸ ì‹¤í–‰
                bossTimersRef.update(updates)
                    .then(() => {
                        playRespawnSound(); // ì „ì²´ ë¦¬ì   ì‚¬ìš´ë“œ ì¬ìƒ
                        showNotification(`${deadBosses.length}ë§ˆë¦¬ì˜ ë³´ìŠ¤ê°€ ëª¨ë‘ ë¦¬ì  ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                    })
                    .catch((error) => {
                        console.error('ì „ì²´ ë¦¬ì   ì‹¤íŒ¨:', error);
                        showNotification('ì „ì²´ ë¦¬ì  ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    });
            }
        }

        // ë¹ ë¥¸ ì²˜ì¹˜ ê¸°ëŠ¥
        function processQuickKill() {
            if (!bosses || !Array.isArray(bosses)) {
                console.error('ë³´ìŠ¤ ë°ì´í„°ê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                showNotification('ë³´ìŠ¤ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            console.log('processQuickKill í•¨ìˆ˜ ì‹¤í–‰ë¨');
            const input = document.getElementById('quickKillInput');
            const inputText = input.value.trim();
            
            console.log('ì…ë ¥ëœ í…ìŠ¤íŠ¸:', inputText);
            
            if (!inputText) {
                showNotification('ë³´ìŠ¤ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // "ã…‹" ë˜ëŠ” "ì»·" í‚¤ì›Œë“œ í™•ì¸
            const killKeywords = ['ã…‹', 'ì»·'];
            let bossName = '';
            let isKillCommand = false;
            let customTime = null;
            
            // ì‹œê°„ íŒ¨í„´ í™•ì¸ (HHMMSS ë˜ëŠ” HHMM í˜•ì‹)
            const timePattern = /^(\d{6}|\d{4})\s+/;
            const timeMatch = inputText.match(timePattern);
            let remainingText = inputText;
            
            if (timeMatch) {
                const timeStr = timeMatch[1];
                const now = new Date();
                customTime = new Date();
                
                // ì‹œê°„ ë¶€ë¶„ì„ ì œì™¸í•œ ë‚˜ë¨¸ì§€ í…ìŠ¤íŠ¸ ì¶”ì¶œ
                remainingText = inputText.substring(timeMatch[0].length);
                
                if (timeStr.length === 6) {
                    // HHMMSS í˜•ì‹
                    const hours = parseInt(timeStr.substring(0, 2));
                    const minutes = parseInt(timeStr.substring(2, 4));
                    const seconds = parseInt(timeStr.substring(4, 6));
                    
                    if (hours >= 0 && hours <= 48 && minutes >= 0 && minutes <= 59 && seconds >= 0 && seconds <= 59) {
                        customTime.setHours(hours, minutes, seconds, 0);
                    } else {
                        showNotification('ì˜¬ë°”ë¥¸ ì‹œê°„ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤. (HHMMSS)');
                        return;
                    }
                } else if (timeStr.length === 4) {
                    // HHMM í˜•ì‹
                    const hours = parseInt(timeStr.substring(0, 2));
                    const minutes = parseInt(timeStr.substring(2, 4));
                    
                    if (hours >= 0 && hours <= 48 && minutes >= 0 && minutes <= 59) {
                        customTime.setHours(hours, minutes, 0, 0);
                    } else {
                        showNotification('ì˜¬ë°”ë¥¸ ì‹œê°„ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤. (HHMM)');
                        return;
                    }
                }

                // ì…ë ¥ëœ ì‹œê°„ì´ í˜„ì¬ ì‹œê°„ë³´ë‹¤ ìµœëŒ€ 24ì‹œê°„ ì´ìƒ ì´ì „ì¸ ê²½ìš° ì—ëŸ¬
                const timeDiff = now - customTime;
                if (timeDiff < 0) {
                    showNotification('ë¯¸ë˜ ì‹œê°„ì€ ì…ë ¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                if (timeDiff > 24 * 60 * 60 * 1000) {
                    showNotification('24ì‹œê°„ ì´ìƒ ì´ì „ì˜ ì‹œê°„ì€ ì…ë ¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                console.log('ì…ë ¥ëœ ì‹œê°„:', timeStr);
                console.log('ë³€í™˜ëœ ì‹œê°„:', customTime.toLocaleString());
                console.log('í˜„ì¬ ì‹œê°„:', now.toLocaleString());
            }
            
            // "ã…‹" ë˜ëŠ” "ì»·" í‚¤ì›Œë“œë¡œ ë³´ìŠ¤ ì´ë¦„ ì¶”ì¶œ
            for (const keyword of killKeywords) {
                if (remainingText.includes(keyword)) {
                    isKillCommand = true;
                    bossName = remainingText.split(keyword)[0].trim();
                    break;
                }
            }
            
            if (!isKillCommand) {
                showNotification('ì²˜ì¹˜ ëª…ë ¹ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. "ã…‹" ë˜ëŠ” "ì»·"ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!bossName) {
                showNotification('ë³´ìŠ¤ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            console.log('í˜„ì¬ ë³´ìŠ¤ ëª©ë¡:', bosses);
            
            // ë³´ìŠ¤ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰ (ë¶€ë¶„ ì¼ì¹˜ í—ˆìš©)
            let matchingBosses = bosses.filter(boss => {
                if (!boss || !boss.name) return false;
                
                const searchName = bossName.toLowerCase().trim();
                const targetName = boss.name.toLowerCase().trim();
                console.log(`ë¹„êµ: ì…ë ¥='${searchName}', ë³´ìŠ¤='${targetName}'`);
                
                // ì •í™•í•œ ì¼ì¹˜
                if (targetName === searchName) return true;
                
                // ì…ë ¥ëœ ì´ë¦„ì´ 'í•˜ë“œ'ë¡œ ëë‚˜ëŠ” ê²½ìš° (ì˜ˆ: "ì¼€ë¥´í•˜ë“œ")
                if (searchName.endsWith('í•˜ë“œ')) {
                    // ëŒ€ìƒ ë³´ìŠ¤ê°€ í•˜ë“œë³´ìŠ¤ê°€ ì•„ë‹ˆë©´ ë§¤ì¹­ ì•ˆí•¨
                    if (!targetName.endsWith('í•˜ë“œ')) return false;
                    
                    // í•˜ë“œë¥¼ ì œì™¸í•œ ë¶€ë¶„ì´ ë³´ìŠ¤ ì´ë¦„ì˜ ì‹œì‘ ë¶€ë¶„ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
                    const searchBase = searchName.slice(0, -2); // "í•˜ë“œ" ì œì™¸
                    const targetBase = targetName.slice(0, -2); // "í•˜ë“œ" ì œì™¸
                    return targetBase.startsWith(searchBase) && searchBase.length >= 2;
                }
                
                // ì…ë ¥ëœ ì´ë¦„ì´ 'í•˜ë“œ'ë¡œ ëë‚˜ì§€ ì•ŠëŠ” ê²½ìš° (ì¼ë°˜ ë³´ìŠ¤ ê²€ìƒ‰)
                if (!searchName.endsWith('í•˜ë“œ')) {
                    // í•˜ë“œë³´ìŠ¤ëŠ” ë§¤ì¹­ì—ì„œ ì œì™¸
                    if (targetName.endsWith('í•˜ë“œ')) return false;
                    
                    // ì¼ë°˜ ë³´ìŠ¤ì˜ ê²½ìš° ì‹œì‘ ë¶€ë¶„ ë§¤ì¹­ í—ˆìš© (ìµœì†Œ 2ê¸€ì)
                    return targetName.startsWith(searchName) && searchName.length >= 2;
                }
                
                return false;
            });

            // ë§¤ì¹­ëœ ë³´ìŠ¤ê°€ ì—¬ëŸ¬ ê°œì¸ ê²½ìš° ì²˜ë¦¬
            if (matchingBosses.length > 1) {
                const matchedNames = matchingBosses.map(b => b.name).join(', ');
                showNotification(`"${bossName}"ì™€(ê³¼) ì¼ì¹˜í•˜ëŠ” ë³´ìŠ¤ê°€ ì—¬ëŸ¬ ê°œ ìˆìŠµë‹ˆë‹¤ (${matchedNames}). ë” ì •í™•í•œ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.`);
                return;
            }
            
            // ë§¤ì¹­ëœ ë³´ìŠ¤ê°€ ì—†ëŠ” ê²½ìš°
            if (matchingBosses.length === 0) {
                showNotification(`"${bossName}" ë³´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                return;
            }

            const matchedBoss = matchingBosses[0];
            console.log('ë§¤ì¹­ëœ ë³´ìŠ¤:', matchedBoss);
            
            // ë³´ìŠ¤ê°€ ì´ë¯¸ dead ìƒíƒœì¸ ê²½ìš°
            if (matchedBoss.status === 'dead') {
                console.log('ì‚¬ë§ ìƒíƒœ ë³´ìŠ¤ ì²˜ë¦¬ ì‹œì‘');
                // ë¨¼ì € ë¦¬ì   ì²˜ë¦¬ (ë¯¸ë“±ë¡ ìƒíƒœëŠ” ë³´ì¡´)
                const revivedBoss = {
                    ...matchedBoss,
                    status: 'alive',
                    lastKilled: null,
                    nextRespawn: null,
                    autoProcessed: false
                };
                
                // Firebaseì—ì„œ ë¦¬ì   í›„ ì¦‰ì‹œ ì²˜ì¹˜
                bossTimersRef.child(matchedBoss.id.toString()).update(revivedBoss)
                    .then(() => {
                        console.log('ë¦¬ì   ì™„ë£Œ, ì²˜ì¹˜ ì§„í–‰');
                        speak(`${matchedBoss.name} ë³´ìŠ¤ê°€ ë¦¬ì  ë˜ì—ˆìŠµë‹ˆë‹¤.`); // TTS ì‚¬ìš©
                        // ë¦¬ì   í›„ ì¦‰ì‹œ ì²˜ì¹˜
                        const killTime = customTime || new Date();
                        const killedBoss = {
                            ...revivedBoss,
                            status: 'dead',
                            lastKilled: killTime.toISOString(),
                            nextRespawn: new Date(killTime.getTime() + matchedBoss.respawnTime * 60000).toISOString(),
                            unregistered: false,
                            autoProcessed: false  // ìˆ˜ë™ ì²˜ì¹˜ë¡œ ì²˜ë¦¬
                        };
                        
                        return bossTimersRef.child(matchedBoss.id.toString()).update(killedBoss);
                    })
                    .then(() => {
                        const respawnHours = Math.floor(matchedBoss.respawnTime / 60);
                        const respawnMins = matchedBoss.respawnTime % 60;
                        const respawnTimeText = respawnHours > 0 ? `${respawnHours}ì‹œê°„ ${respawnMins}ë¶„` : `${respawnMins}ë¶„`;
                        const timeText = customTime ? 
                            `${customTime.getHours().toString().padStart(2, '0')}:${customTime.getMinutes().toString().padStart(2, '0')}:${customTime.getSeconds().toString().padStart(2, '0')}` : 
                            'í˜„ì¬ ì‹œê°„';
                        
                        speak(`${matchedBoss.name} ë³´ìŠ¤ë¥¼ ì²˜ì¹˜í–ˆìŠµë‹ˆë‹¤!`); // TTS ì‚¬ìš©
                        showNotification(`${matchedBoss.name}ì„(ë¥¼) ${timeText} ê¸°ì¤€ìœ¼ë¡œ ì²˜ì¹˜í–ˆìŠµë‹ˆë‹¤! ${respawnTimeText} í›„ ë¦¬ì  ë©ë‹ˆë‹¤.`);
                    })
                    .catch((error) => {
                        console.error('ë¦¬ì   í›„ ì²˜ì¹˜ ì‹¤íŒ¨:', error);
                        showNotification('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    });
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                input.value = '';
                input.blur();
                return;
            }
            
            console.log('ë³´ìŠ¤ ì²˜ì¹˜ ì‹¤í–‰:', matchedBoss.name);
            
            // ë³´ìŠ¤ ì²˜ì¹˜ ì‹¤í–‰ (ì‹œê°„ ì§€ì • ì²˜ì¹˜)
            const now = customTime || new Date();
            const updatedBoss = {
                ...matchedBoss,
                status: 'dead',
                lastKilled: now.toISOString(),
                nextRespawn: new Date(now.getTime() + matchedBoss.respawnTime * 60000).toISOString(),
                unregistered: false,
                autoProcessed: false  // ìˆ˜ë™ ì²˜ì¹˜ë¡œ ì²˜ë¦¬
            };
            
            bossTimersRef.child(matchedBoss.id.toString()).update(updatedBoss)
                .then(() => {
                    const timeText = customTime ? 
                        `${customTime.getHours().toString().padStart(2, '0')}:${customTime.getMinutes().toString().padStart(2, '0')}:${customTime.getSeconds().toString().padStart(2, '0')}` : 
                        'í˜„ì¬ ì‹œê°„';
                    speak(`${matchedBoss.name} ë³´ìŠ¤ë¥¼ ì²˜ì¹˜í–ˆìŠµë‹ˆë‹¤!`); // TTS ì‚¬ìš©
                    showNotification(`${matchedBoss.name}ì„(ë¥¼) ${timeText} ê¸°ì¤€ìœ¼ë¡œ ì²˜ì¹˜í–ˆìŠµë‹ˆë‹¤! ${formatTime(matchedBoss.respawnTime * 60000)} í›„ ë¦¬ì  ë©ë‹ˆë‹¤.`);
                })
                .catch((error) => {
                    console.error('ë³´ìŠ¤ ì²˜ì¹˜ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                    showNotification('ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                });
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            input.value = '';
            input.blur();
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            const total = bosses.length;
            const alive = bosses.filter(b => b.status === 'alive').length;
            const dead = bosses.filter(b => b.status === 'dead').length;
            const respawnSoon = bosses.filter(b => {
                if (b.status === 'dead' && b.nextRespawn) {
                    const timeDiff = new Date(b.nextRespawn) - new Date();
                    return timeDiff > 0 && timeDiff <= 600000; // 10ë¶„ ì´ë‚´
                }
                return false;
            }).length;
            
            document.getElementById('totalBosses').textContent = total;
            document.getElementById('aliveBosses').textContent = alive;
            document.getElementById('deadBosses').textContent = dead;
            document.getElementById('respawnSoon').textContent = respawnSoon;
        }
        
        // ì•Œë¦¼ í‘œì‹œ
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // ì‚¬ìš´ë“œ í† ê¸€ í•¨ìˆ˜
        function toggleSound() {
            soundEnabled = !soundEnabled;
            localStorage.setItem('soundEnabled', soundEnabled.toString());
            updateSoundButton();
            
            if (soundEnabled) {
                showNotification('ğŸ”Š ì‚¬ìš´ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
                // í…ŒìŠ¤íŠ¸ ì‚¬ìš´ë“œ ì¬ìƒ
                playRespawnSound();
            } else {
                showNotification('ğŸ”‡ ì‚¬ìš´ë“œê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
            }
        }

        // ì‚¬ìš´ë“œ ë²„íŠ¼ ì—…ë°ì´íŠ¸
        function updateSoundButton() {
            const soundButton = document.getElementById('soundToggle');
            if (soundButton) {
                soundButton.textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
                soundButton.title = soundEnabled ? 'ì‚¬ìš´ë“œ ë„ê¸°' : 'ì‚¬ìš´ë“œ ì¼œê¸°';
            }
        }

        function setBossFilter(filter) {
            bossFilter = filter;
            renderBossesUI();
            // ì„ íƒ íš¨ê³¼
            document.querySelectorAll('.stat-card').forEach(card => card.classList.remove('selected'));
            if (filter === 'all') document.getElementById('statTotal').classList.add('selected');
            if (filter === 'alive') document.getElementById('statAlive').classList.add('selected');
            if (filter === 'dead') document.getElementById('statDead').classList.add('selected');
            if (filter === 'soon') document.getElementById('statSoon').classList.add('selected');
        }

        // ê³ ì •ë³´ìŠ¤ ë“±ë¡ í¼ ì œì¶œ ì²˜ë¦¬
        document.getElementById('fixedBossForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!isLoggedIn) {
                showNotification('ê´€ë¦¬ìë§Œ ë³´ìŠ¤ë¥¼ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            const name = document.getElementById('fixedBossName').value.trim();
            const location = document.getElementById('fixedLocation').value.trim() || 'ë¯¸ì„¤ì •';
            const hour = parseInt(document.getElementById('fixedHour').value);
            const minute = parseInt(document.getElementById('fixedMinute').value);
            
            // ì„ íƒëœ ìš”ì¼ ë°°ì—´ ìƒì„±
            const selectedDays = [];
            for (let i = 0; i < 7; i++) {
                if (document.getElementById(`fixedDay${i}`).checked) {
                    selectedDays.push(i);
                }
            }
            
            if (!name) {
                showNotification('ë³´ìŠ¤ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (selectedDays.length === 0) {
                showNotification('ìµœì†Œ í•˜ë‚˜ì˜ ìš”ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (isNaN(hour) || isNaN(minute) || 
                hour < 0 || hour > 48 || 
                minute < 0 || minute > 59) {
                showNotification('ì˜¬ë°”ë¥¸ ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ìƒˆ ë³´ìŠ¤ ë°ì´í„° ìƒì„±
            const newBoss = {
                id: Date.now(),
                name: name,
                location: location,
                fixed: true,
                fixedDays: selectedDays,
                fixedHour: hour,
                fixedMinute: minute,
                status: 'dead',  // ì´ˆê¸° ìƒíƒœë¥¼ deadë¡œ ë³€ê²½
                lastKilled: null,
                nextRespawn: null,
                respawnTime: 0,
                autoProcessed: false,  // autoProcessed ì¶”ê°€
                unregistered: false    // unregistered ì¶”ê°€
            };
            
            // Firebaseì— ì €ì¥
            bossTimersRef.child(newBoss.id.toString()).set(newBoss)
                .then(() => {
                    // í¼ ì´ˆê¸°í™”
                    document.getElementById('fixedBossName').value = '';
                    document.getElementById('fixedLocation').value = '';
                    document.getElementById('fixedHour').value = '0';
                    document.getElementById('fixedMinute').value = '0';
                    // ìš”ì¼ ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
                    for (let i = 0; i < 7; i++) {
                        document.getElementById(`fixedDay${i}`).checked = false;
                    }
                    
                    showNotification(`${name} ë³´ìŠ¤ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                })
                .catch((error) => {
                    console.error('ë³´ìŠ¤ ë“±ë¡ ì‹¤íŒ¨:', error);
                    showNotification('ë³´ìŠ¤ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                });
        });

        // ì‹œê°„ ì…ë ¥ ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜ ì¶”ê°€
        function validateTimeInput(input, min, max) {
            let value = parseInt(input.value);
            if (isNaN(value) || value < min || value > max) {
                value = Math.min(Math.max(min, value || 0), max);
                input.value = value;
            }
        }

        // TTS ì‹¤í–‰ í•¨ìˆ˜
        function speak(text) {
            try {
                if ('speechSynthesis' in window) {
                    // ì´ì „ ìŒì„±ì´ ì¬ìƒ ì¤‘ì´ë©´ ì¤‘ì§€
                    window.speechSynthesis.cancel();

                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'ko-KR';
                    utterance.rate = 1.0;
                    utterance.pitch = 1.0;
                    utterance.volume = 1.0;

                    console.log('ìŒì„± ì¬ìƒ ì‹œì‘:', text);
                    window.speechSynthesis.speak(utterance);
                } else {
                    console.error('ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± í•©ì„±ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    showNotification('ğŸ”‡ ìŒì„± ì•ˆë‚´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ìŒì„± ì¬ìƒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                showNotification('ğŸ”‡ ìŒì„± ì•ˆë‚´ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë³´ìŠ¤ ì²˜ì¹˜ ì²˜ë¦¬ í•¨ìˆ˜
        function processBossKill(boss, killTime) {
            const updates = {};
            updates[`${boss.id}/killTime`] = killTime;
            updates[`${boss.id}/status`] = 'dead';
            
            // ìŒì„± ì•ˆë‚´ ë¨¼ì € ì‹¤í–‰
            console.log('ë³´ìŠ¤ ì²˜ì¹˜ ìŒì„± ì•ˆë‚´ ì‹œì‘');
            speak(`${boss.name} ë³´ìŠ¤ê°€ ì²˜ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤.`);

            bossTimersRef.update(updates)
                .then(() => {
                    console.log('ì²˜ì¹˜ ì‹œê°„ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                })
                .catch(error => {
                    console.error('ì²˜ì¹˜ ì‹œê°„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                    showNotification('âŒ ì²˜ì¹˜ ì‹œê°„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨');
                });
        }

        // ë³´ìŠ¤ ë¦¬ì   ì²˜ë¦¬ í•¨ìˆ˜
        function processBossRespawn(boss) {
            const updates = {};
            updates[`${boss.id}/killTime`] = null;
            updates[`${boss.id}/status`] = 'alive';
            
            // ìŒì„± ì•ˆë‚´ ë¨¼ì € ì‹¤í–‰
            console.log('ë³´ìŠ¤ ë¦¬ì   ìŒì„± ì•ˆë‚´ ì‹œì‘');
            speak(`${boss.name} ë³´ìŠ¤ê°€ ë¦¬ì  ë˜ì—ˆìŠµë‹ˆë‹¤.`);

            bossTimersRef.update(updates)
                .then(() => {
                    console.log('ë¦¬ì   ì²˜ë¦¬ ì™„ë£Œ');
                })
                .catch(error => {
                    console.error('ë¦¬ì   ì²˜ë¦¬ ì‹¤íŒ¨:', error);
                    showNotification('âŒ ë¦¬ì   ì²˜ë¦¬ ì‹¤íŒ¨');
                });
        }

        // ìë™ ì—…ë°ì´íŠ¸ ì²˜ë¦¬
        function processAutoUpdates(updates, hasRespawns) {
            // ë¦¬ì  ëœ ë³´ìŠ¤ë“¤ì— ëŒ€í•´ TTS ë¨¼ì € ì‹¤í–‰
            if (hasRespawns) {
                Object.keys(updates).forEach(key => {
                    if (key.endsWith('/status') && updates[key] === 'alive') {
                        const bossId = key.split('/')[0];
                        const boss = bosses.find(b => b.id.toString() === bossId);
                        if (boss) {
                            console.log('ìë™ ë¦¬ì   ìŒì„± ì•ˆë‚´ ì‹œì‘:', boss.name);
                            speak(`${boss.name} ë³´ìŠ¤ê°€ ë¦¬ì  ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                        }
                    }
                });
            }

            bossTimersRef.update(updates)
                .then(() => {
                    console.log('ìë™ ì²˜ë¦¬ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                })
                .catch(error => {
                    console.error('ìë™ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                    showNotification('âŒ ìë™ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨');
                });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¤€ë¹„ ì™„ë£Œ ì•Œë¦¼
        window.addEventListener('load', () => {
            showNotification('ğŸ”Š ë³´ìŠ¤ íƒ€ì´ë¨¸ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. ìŒì„± ì•ˆë‚´ê°€ ì¬ìƒë©ë‹ˆë‹¤.');
        });

        // ë³´ìŠ¤ ì²˜ì¹˜ ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬
        function handleKillClick(boss) {
            console.log('ì²˜ì¹˜ ë²„íŠ¼ í´ë¦­:', boss.name);
            handleBossEvent(boss, true);
        }

        // ë³´ìŠ¤ ë¦¬ì   ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬
        function handleRespawnClick(boss) {
            console.log('ë¦¬ì   ë²„íŠ¼ í´ë¦­:', boss.name);
            handleBossEvent(boss, false);
        }

        // ë³´ìŠ¤ ìš”ì†Œ ìƒì„± í•¨ìˆ˜
        function createBossElement(boss) {
            const bossDiv = document.createElement('div');
            bossDiv.className = 'boss-item';
            bossDiv.id = `boss-${boss.id}`;

            const bossName = document.createElement('div');
            bossName.className = 'boss-name';
            bossName.textContent = boss.name;

            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'button-container';

            const killButton = document.createElement('button');
            killButton.className = 'action-button kill-button';
            killButton.textContent = 'ì²˜ì¹˜';
            killButton.onclick = () => handleKillClick(boss);

            const respawnButton = document.createElement('button');
            respawnButton.className = 'action-button respawn-button';
            respawnButton.textContent = 'ë¦¬ì  ';
            respawnButton.onclick = () => handleRespawnClick(boss);

            const timerDisplay = document.createElement('div');
            timerDisplay.className = 'timer-display';
            timerDisplay.id = `timer-${boss.id}`;

            buttonContainer.appendChild(killButton);
            buttonContainer.appendChild(respawnButton);
            buttonContainer.appendChild(timerDisplay);

            bossDiv.appendChild(bossName);
            bossDiv.appendChild(buttonContainer);

            return bossDiv;
        }



        // ë³´ìŠ¤ ë°ì´í„° ì—…ë°ì´íŠ¸ ì²˜ë¦¬
        function updateBossData() {
            const now = new Date().getTime();
            const updates = {};
            let hasRespawns = false;

            bosses.forEach(boss => {
                const timerElement = document.getElementById(`timer-${boss.id}`);
                const bossElement = document.getElementById(`boss-${boss.id}`);
                
                if (!timerElement || !bossElement) return;

                const killTime = boss.killTime;
                if (!killTime) {
                    timerElement.textContent = 'ëŒ€ê¸° ì¤‘';
                    bossElement.classList.remove('dead');
                    return;
                }

                const respawnTime = new Date(killTime + boss.respawnHours * 60 * 60 * 1000);
                const timeDiff = respawnTime - now;

                if (timeDiff <= 0 && boss.status === 'dead') {
                    updates[`${boss.id}/status`] = 'alive';
                    updates[`${boss.id}/killTime`] = null;
                    hasRespawns = true;
                    boss.status = 'alive';
                    boss.killTime = null;
                }

                if (boss.status === 'dead') {
                    const hours = Math.floor(timeDiff / (60 * 60 * 1000));
                    const minutes = Math.floor((timeDiff % (60 * 60 * 1000)) / (60 * 1000));
                    timerElement.textContent = `${hours}ì‹œê°„ ${minutes}ë¶„`;
                    bossElement.classList.add('dead');
                } else {
                    timerElement.textContent = 'ëŒ€ê¸° ì¤‘';
                    bossElement.classList.remove('dead');
                }
            });

            if (Object.keys(updates).length > 0) {
                bossTimersRef.update(updates)
                    .then(() => {
                        console.log('ìë™ ì²˜ë¦¬ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                        if (hasRespawns) {
                            // ë¦¬ì  ëœ ë³´ìŠ¤ë“¤ì— ëŒ€í•´ TTS ì‹¤í–‰
                            Object.keys(updates).forEach(key => {
                                if (key.endsWith('/status') && updates[key] === 'alive') {
                                    const bossId = key.split('/')[0];
                                    const boss = bosses.find(b => b.id.toString() === bossId);
                                    if (boss) {
                                        speak(`${boss.name} ë³´ìŠ¤ê°€ ë¦¬ì  ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                                    }
                                }
                            });
                        }
                    })
                    .catch(error => {
                        console.error('ìë™ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                        showNotification('âŒ ìë™ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨');
                    });
            }
        }

        // ë³´ìŠ¤ ì²˜ì¹˜/ë¦¬ì   ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        function handleBossEvent(boss, isKill = true) {
            const updates = {};
            if (isKill) {
                updates[`${boss.id}/killTime`] = new Date().getTime();
                updates[`${boss.id}/status`] = 'dead';
            } else {
                updates[`${boss.id}/killTime`] = null;
                updates[`${boss.id}/status`] = 'alive';
            }
            
            bossTimersRef.update(updates)
                .then(() => {
                    const message = isKill ? 
                        `${boss.name} ë³´ìŠ¤ê°€ ì²˜ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤.` : 
                        `${boss.name} ë³´ìŠ¤ê°€ ë¦¬ì  ë˜ì—ˆìŠµë‹ˆë‹¤.`;
                    console.log(isKill ? 'ì²˜ì¹˜ ì‹œê°„ ì—…ë°ì´íŠ¸ ì™„ë£Œ' : 'ë¦¬ì   ì²˜ë¦¬ ì™„ë£Œ');
                    speak(message);
                })
                .catch(error => {
                    console.error(isKill ? 'ì²˜ì¹˜ ì‹œê°„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨' : 'ë¦¬ì   ì²˜ë¦¬ ì‹¤íŒ¨', error);
                    showNotification('âŒ ' + (isKill ? 'ì²˜ì¹˜ ì‹œê°„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨' : 'ë¦¬ì   ì²˜ë¦¬ ì‹¤íŒ¨'));
                });
        }
    </script>
</body>
</html> 
